import{a as v,j as e,k as C,l as j,ac as I,B,i as R,t as F,ad as T,ae as z,af as E,ag as L,a4 as P}from"./index-Cpw8-sIN.js";import{a as V,F as y,C as $,u as M}from"./FormField-CRze1Nfb.js";import{R as U}from"./Radio-D2T2h27Y.js";import{G as g}from"./Group-ClA9n1Zg.js";import{T as G}from"./TextInput-S_Svj1GS.js";import{F as _}from"./FileInput-DDThIfrJ.js";import{B as p}from"./Button-6VQsS5-2.js";import{I as A}from"./Image-BKMAk-5u.js";import{T as h}from"./Text-CaXGekgx.js";import{c as k}from"./createLucideIcon-CRXIWQGc.js";import{c as D,d as w,e as q,o as N}from"./index.esm-O3HBwZ_V.js";import{G as b,S as O}from"./StatBox-DGftQRaC.js";import{b as Y}from"./useApi-CfP4W4FW.js";import{c as H}from"./selectors-BfVctv7J.js";import{S as W}from"./Stack-DSJynHOL.js";import{T as J}from"./Textarea-DBKdXFW_.js";import"./get-auto-contrast-value-Da6zqqWm.js";import"./DirectionProvider-BlbALnWT.js";import"./ActionIcon-CGKjMjnN.js";import"./Flex-Di6lWYG5.js";import"./chevron-up-Dj9UxHHz.js";import"./chevron-down-BU-Mpjy3.js";import"./get-style-object-DUJZA7T_.js";import"./get-env-uyVen0u2.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M15 6v6h4l-7 7-7-7h4V6h6z",key:"1thax2"}]],Q=k("arrow-big-down",K);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M9 18v-6H5l7-7 7 7h-4v6H9z",key:"1x06kx"}]],Z=k("arrow-big-up",X);function ee({control:o,setValue:n}){const[d,l]=v.useState("url"),i=V({control:o,name:"introVideoUrl"}),a=V({control:o,name:"introVideoFile"});return v.useEffect(()=>{a?l("upload"):i&&l("url")},[i,a]),e.jsxs(e.Fragment,{children:[e.jsx(U.Group,{value:d,onChange:r=>l(r),label:"Intro Video Source",children:e.jsxs(g,{mt:"xs",children:[e.jsx(U,{value:"url",label:"Enter URL"}),e.jsx(U,{value:"upload",label:"Upload File"})]})}),d==="url"?e.jsx(y,{name:"introVideoUrl",control:o,Component:G,componentProps:{label:"Intro Video URL",placeholder:"Paste YouTube video URL",onChange:r=>{n("introVideoUrl",r.currentTarget.value),a&&n("introVideoFile",null)}}}):e.jsx($,{name:"introVideoFile",control:o,render:({field:r,fieldState:{error:m}})=>e.jsx(_,{label:"Upload Intro Video",accept:"video/*",placeholder:"Upload your video",value:r.value,onChange:u=>{r.onChange(u),i&&n("introVideoUrl","")},error:m==null?void 0:m.message})})]})}const oe=({control:o})=>{const[n,d]=v.useState(""),[l,i]=v.useState(!1),a=C(),r=j(s=>s.bio.gamesUrl),m=async s=>{try{const t=await(await fetch(`https://api.microlink.io?url=${encodeURIComponent(s)}`)).json();if(t.status==="success"){const{title:c,logo:f}=t.data;return{title:c||s,favicon:f||`https://www.google.com/s2/favicons?sz=64&domain_url=${s}`}}}catch{return{title:s,favicon:`https://www.google.com/s2/favicons?sz=64&domain_url=${s}`}}},u=async()=>{const s=n.trim();if(!s)return;i(!0);const x=await m(s),c=r.filter(f=>f.favorite).length<4;a(I({url:s,...x,favorite:c})),d(""),i(!1)};return e.jsxs(g,{align:"flex-end",spacing:"sm",children:[e.jsx(y,{name:"gamesUrl",control:o,Component:G,componentProps:{label:"Preferred Game URL",placeholder:"Enter game site URL",value:n,onChange:s=>d(s.currentTarget.value),style:{flexGrow:1}}}),e.jsx(p,{fz:26,lh:1.2,variant:"primary",onClick:u,loading:l,children:"+"})]})};function re({games:o,onDelete:n,onFavoriteToggle:d,onMove:l}){const i=o.filter(a=>a.favorite).length;return e.jsx(e.Fragment,{children:o==null?void 0:o.map((a,r)=>{var m;return e.jsxs(g,{spacing:"sm",align:"center",children:[e.jsx(A,{w:32,h:32,src:(m=a.favicon)==null?void 0:m.url,alt:"favicon"}),e.jsxs(B,{style:{flexGrow:1},children:[e.jsx(h,{fw:500,children:a.title}),e.jsx(h,{size:"xs",c:"dimmed",children:a.url})]}),e.jsx(p,{variant:"subtle",disabled:!a.favorite&&i>=4,onClick:()=>d(r),title:a.favorite?"Unmark as favorite":i>=4?"You can only mark up to 4 favorite games":"Mark as favorite",children:a.favorite?e.jsx(h,{children:"Unfavorite"}):e.jsx(h,{children:"Favorite"})}),e.jsx(p,{variant:"light",onClick:()=>l(r,r-1),disabled:r===0,title:"Move Up",children:e.jsx(Z,{size:16})}),e.jsx(p,{variant:"light",onClick:()=>l(r,r+1),disabled:r===o.length-1,title:"Move Down",children:e.jsx(Q,{size:16})}),e.jsx(p,{size:"xs",color:"red",variant:"light",onClick:()=>n(r),children:"Delete"})]},r)})})}const te=o=>{try{const d=new URL(o).hostname;return["youtube.com","youtu.be"].some(l=>d.includes(l))}catch{return!1}},ie=D().shape({introVideoUrl:w().nullable().notRequired().test("is-supported-video-platform","Only YouTube URLs are supported for now",(o,n)=>o?te(o):!!n.parent.introVideoFile).url("Enter a valid video URL"),introVideoFile:q().nullable().notRequired().test("is-video-file","Only video files are allowed",(o,n)=>o?o instanceof File&&o.type.startsWith("video/"):!!n.parent.introVideoUrl),bio:w().max(1e3,"Bio must be under 500 characters").required("Bio is required")});function ke(){const{control:o,handleSubmit:n,setValue:d,reset:l}=M({resolver:N(ie),defaultValues:{introVideoUrl:"",introVideoFile:null,bio:"",gamesUrl:[]}}),{user:i}=j(H),{patch:a}=Y(),r=C(),m=R(),u=j(t=>t.bio),s=u.gamesUrl;v.useEffect(()=>{var t,c;l({bio:u.bio||((t=i==null?void 0:i.userBio)==null?void 0:t.bio)||"",introVideoUrl:u.introVideoUrl||((c=i==null?void 0:i.userBio)==null?void 0:c.videoBioUrl)||"",introVideoFile:u.introVideoFile||null,gamesUrl:s||[]})},[u,i,l]);const x=async t=>{try{const c={bio:t.bio,videoBioUrl:t.introVideoUrl,userId:i.id,preferredGames:s.map((f,S)=>({gameUrl:f.url,sortOrder:S}))};await a("/users-bio.controller",c),r(L({bio:t.bio,introVideoUrl:t.introVideoUrl,introVideoFile:t.introVideoFile,gamesUrl:s})),r(P()),alert("Profile Updated Successfully"),m("/profile")}catch(c){alert("Failed to update bio"),console.error(c)}};return e.jsxs(e.Fragment,{children:[e.jsxs(g,{pos:"relative",justify:"center",children:[e.jsx(p,{pos:"absolute",left:0,variant:"darkGrey",onClick:()=>m(-1),children:"Back"}),e.jsx(h,{fz:35,align:"center",mb:20,children:"Edit Bio"})]}),e.jsxs(b,{gutter:20,children:[e.jsx(b.Col,{span:{base:12,md:6,lg:8},children:e.jsx(B,{p:"md",bg:F.colors.secondaryGrey[0],style:{borderRadius:F.radius.md},children:e.jsx("form",{onSubmit:n(x),children:e.jsxs(W,{p:20,children:[e.jsx(ee,{control:o,setValue:d}),e.jsx(y,{name:"bio",control:o,Component:J,componentProps:{label:"Bio",placeholder:"Enter your Bio"}}),e.jsx(oe,{control:o}),e.jsx(re,{games:s,onDelete:t=>r(E(t)),onFavoriteToggle:t=>r(z(t)),onMove:(t,c)=>r(T({from:t,to:c}))}),e.jsx(p,{type:"submit",variant:"primary",width:"10em",children:"Save"})]})})})}),e.jsx(b.Col,{span:{base:12,md:6,lg:4},children:e.jsx(O,{title:"Preview"})})]})]})}export{ke as default};
