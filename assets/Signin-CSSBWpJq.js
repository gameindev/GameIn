import{r as y,H as be,j as s,I as Ne,J as Ce,B as E,K as ke,M as Pe,N as k,z as B,P as Ee,f as T,u as w,a as D,e as Oe,w as Ie,A as Ae,y as Re,F,k as Q,i as q,Q as Le,S as H,o as C,L as _e,T as $e}from"./index-DZw1vJjZ.js";import{u as X,o as ee,b as G,S as z,F as U,A as W,s as j,a as Fe,G as V}from"./FormField-D_q_5OHQ.js";import{c as De,S as He,O as ze,P as Ue,l as Ge}from"./validationSchema-6h4APAIM.js";import{d as We,F as Ye,b as Y,O as Ze,c as Ve,T as te,s as K}from"./authSlice-DwO0OjpC.js";import{c as se}from"./create-safe-context-CkMpTaXw.js";import{T as oe,B as ae}from"./Button-D-53QOqT.js";import{a as Ke}from"./DirectionProvider-BnH3VkJo.js";import{T as ne}from"./Title-D-MaDJAh.js";import{T as J}from"./Text-CvdnZErH.js";function Je(t,e,o){y.useEffect(()=>(window.addEventListener(t,e,o),()=>window.removeEventListener(t,e,o)),[t,e])}const[Qe,M]=se("ModalBase component was not found in tree");function qe({opened:t,transitionDuration:e}){const[o,l]=y.useState(t),r=y.useRef(-1),c=be()?0:e;return y.useEffect(()=>(t?(l(!0),window.clearTimeout(r.current)):c===0?l(!1):r.current=window.setTimeout(()=>l(!1),c),()=>window.clearTimeout(r.current)),[t,c]),o}function Xe({id:t,transitionProps:e,opened:o,trapFocus:l,closeOnEscape:r,onClose:d,returnFocus:c}){const a=Ke(t),[i,n]=y.useState(!1),[u,f]=y.useState(!1),m=typeof(e==null?void 0:e.duration)=="number"?e==null?void 0:e.duration:200,p=qe({opened:o,transitionDuration:m});return Je("keydown",S=>{var x;S.key==="Escape"&&r&&!S.isComposing&&o&&((x=S.target)==null?void 0:x.getAttribute("data-mantine-stop-propagation"))!=="true"&&d()},{capture:!0}),We({opened:o,shouldReturnFocus:l&&c}),{_id:a,titleMounted:i,bodyMounted:u,shouldLockScroll:p,setTitleMounted:n,setBodyMounted:f}}const re=y.forwardRef(({keepMounted:t,opened:e,onClose:o,id:l,transitionProps:r,onExitTransitionEnd:d,onEnterTransitionEnd:c,trapFocus:a,closeOnEscape:i,returnFocus:n,closeOnClickOutside:u,withinPortal:f,portalProps:m,lockScroll:p,children:S,zIndex:x,shadow:v,padding:P,__vars:fe,unstyled:ye,removeScrollProps:he,...xe},Me)=>{const{_id:Z,titleMounted:ge,bodyMounted:Se,shouldLockScroll:Te,setTitleMounted:we,setBodyMounted:ve}=Xe({id:l,transitionProps:r,opened:e,trapFocus:a,closeOnEscape:i,onClose:o,returnFocus:n}),{key:je,...Be}=he||{};return s.jsx(Ne,{...m,withinPortal:f,children:s.jsx(Qe,{value:{opened:e,onClose:o,closeOnClickOutside:u,onExitTransitionEnd:d,onEnterTransitionEnd:c,transitionProps:{...r,keepMounted:t},getTitleId:()=>`${Z}-title`,getBodyId:()=>`${Z}-body`,titleMounted:ge,bodyMounted:Se,setTitleMounted:we,setBodyMounted:ve,trapFocus:a,closeOnEscape:i,zIndex:x,unstyled:ye},children:s.jsx(Ce,{enabled:Te&&p,...Be,children:s.jsx(E,{ref:Me,...xe,__vars:{...fe,"--mb-z-index":(x||k("modal")).toString(),"--mb-shadow":Pe(v),"--mb-padding":ke(P)},children:S})},je)})})});re.displayName="@mantine/core/ModalBase";function et(){const t=M();return y.useEffect(()=>(t.setBodyMounted(!0),()=>t.setBodyMounted(!1)),[]),t.getBodyId()}var b={title:"m_615af6c9",header:"m_b5489c3c",inner:"m_60c222c7",content:"m_fd1ab0aa",close:"m_606cb269",body:"m_5df29311"};const le=y.forwardRef(({className:t,...e},o)=>{const l=et(),r=M();return s.jsx(E,{ref:o,...e,id:l,className:B({[b.body]:!r.unstyled},t)})});le.displayName="@mantine/core/ModalBaseBody";const ce=y.forwardRef(({className:t,onClick:e,...o},l)=>{const r=M();return s.jsx(Ee,{ref:l,...o,onClick:d=>{r.onClose(),e==null||e(d)},className:B({[b.close]:!r.unstyled},t),unstyled:r.unstyled})});ce.displayName="@mantine/core/ModalBaseCloseButton";const de=y.forwardRef(({transitionProps:t,className:e,innerProps:o,onKeyDown:l,style:r,...d},c)=>{const a=M();return s.jsx(oe,{mounted:a.opened,transition:"pop",...a.transitionProps,onExited:()=>{var i,n,u;(i=a.onExitTransitionEnd)==null||i.call(a),(u=(n=a.transitionProps)==null?void 0:n.onExited)==null||u.call(n)},onEntered:()=>{var i,n,u;(i=a.onEnterTransitionEnd)==null||i.call(a),(u=(n=a.transitionProps)==null?void 0:n.onEntered)==null||u.call(n)},...t,children:i=>s.jsx("div",{...o,className:B({[b.inner]:!a.unstyled},o.className),children:s.jsx(Ye,{active:a.opened&&a.trapFocus,innerRef:c,children:s.jsx(Y,{...d,component:"section",role:"dialog",tabIndex:-1,"aria-modal":!0,"aria-describedby":a.bodyMounted?a.getBodyId():void 0,"aria-labelledby":a.titleMounted?a.getTitleId():void 0,style:[r,i],className:B({[b.content]:!a.unstyled},e),unstyled:a.unstyled,children:d.children})})})})});de.displayName="@mantine/core/ModalBaseContent";const ie=y.forwardRef(({className:t,...e},o)=>{const l=M();return s.jsx(E,{component:"header",ref:o,className:B({[b.header]:!l.unstyled},t),...e})});ie.displayName="@mantine/core/ModalBaseHeader";const tt={duration:200,timingFunction:"ease",transition:"fade"};function st(t){const e=M();return{...tt,...e.transitionProps,...t}}const ue=y.forwardRef(({onClick:t,transitionProps:e,style:o,visible:l,...r},d)=>{const c=M(),a=st(e);return s.jsx(oe,{mounted:l!==void 0?l:c.opened,...a,transition:"fade",children:i=>s.jsx(Ze,{ref:d,fixed:!0,style:[o,i],zIndex:c.zIndex,unstyled:c.unstyled,onClick:n=>{t==null||t(n),c.closeOnClickOutside&&c.onClose()},...r})})});ue.displayName="@mantine/core/ModalBaseOverlay";function ot(){const t=M();return y.useEffect(()=>(t.setTitleMounted(!0),()=>t.setTitleMounted(!1)),[]),t.getTitleId()}const me=y.forwardRef(({className:t,...e},o)=>{const l=ot(),r=M();return s.jsx(E,{component:"h2",ref:o,className:B({[b.title]:!r.unstyled},t),...e,id:l})});me.displayName="@mantine/core/ModalBaseTitle";function at({children:t}){return s.jsx(s.Fragment,{children:t})}const[nt,N]=se("Modal component was not found in tree");var g={root:"m_9df02822",content:"m_54c44539",inner:"m_1f958f16",header:"m_d0e2b9cd"};const rt={},O=T((t,e)=>{const o=w("ModalBody",rt,t),{classNames:l,className:r,style:d,styles:c,vars:a,...i}=o,n=N();return s.jsx(le,{ref:e,...n.getStyles("body",{classNames:l,style:d,styles:c,className:r}),...i})});O.classes=g;O.displayName="@mantine/core/ModalBody";const lt={},I=T((t,e)=>{const o=w("ModalCloseButton",lt,t),{classNames:l,className:r,style:d,styles:c,vars:a,...i}=o,n=N();return s.jsx(ce,{ref:e,...n.getStyles("close",{classNames:l,style:d,styles:c,className:r}),...i})});I.classes=g;I.displayName="@mantine/core/ModalCloseButton";const ct={},A=T((t,e)=>{const o=w("ModalContent",ct,t),{classNames:l,className:r,style:d,styles:c,vars:a,children:i,__hidden:n,...u}=o,f=N(),m=f.scrollAreaComponent||at;return s.jsx(de,{...f.getStyles("content",{className:r,style:d,styles:c,classNames:l}),innerProps:f.getStyles("inner",{className:r,style:d,styles:c,classNames:l}),"data-full-screen":f.fullScreen||void 0,"data-modal-content":!0,"data-hidden":n||void 0,ref:e,...u,children:s.jsx(m,{style:{maxHeight:f.fullScreen?"100dvh":`calc(100dvh - (${D(f.yOffset)} * 2))`},children:i})})});A.classes=g;A.displayName="@mantine/core/ModalContent";const dt={},R=T((t,e)=>{const o=w("ModalHeader",dt,t),{classNames:l,className:r,style:d,styles:c,vars:a,...i}=o,n=N();return s.jsx(ie,{ref:e,...n.getStyles("header",{classNames:l,style:d,styles:c,className:r}),...i})});R.classes=g;R.displayName="@mantine/core/ModalHeader";const it={},L=T((t,e)=>{const o=w("ModalOverlay",it,t),{classNames:l,className:r,style:d,styles:c,vars:a,...i}=o,n=N();return s.jsx(ue,{ref:e,...n.getStyles("overlay",{classNames:l,style:d,styles:c,className:r}),...i})});L.classes=g;L.displayName="@mantine/core/ModalOverlay";const ut={__staticSelector:"Modal",closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:k("modal"),transitionProps:{duration:200,transition:"fade-down"},yOffset:"5dvh"},mt=Ie((t,{radius:e,size:o,yOffset:l,xOffset:r})=>({root:{"--modal-radius":e===void 0?void 0:Re(e),"--modal-size":Ae(o,"modal-size"),"--modal-y-offset":D(l),"--modal-x-offset":D(r)}})),_=T((t,e)=>{const o=w("ModalRoot",ut,t),{classNames:l,className:r,style:d,styles:c,unstyled:a,vars:i,yOffset:n,scrollAreaComponent:u,radius:f,fullScreen:m,centered:p,xOffset:S,__staticSelector:x,...v}=o,P=Oe({name:x,classes:g,props:o,className:r,style:d,classNames:l,styles:c,unstyled:a,vars:i,varsResolver:mt});return s.jsx(nt,{value:{yOffset:n,scrollAreaComponent:u,getStyles:P,fullScreen:m},children:s.jsx(re,{ref:e,...P("root"),"data-full-screen":m||void 0,"data-centered":p||void 0,"data-offset-scrollbars":u===De.Autosize||void 0,unstyled:a,...v})})});_.classes=g;_.displayName="@mantine/core/ModalRoot";const[pt,ft]=Ve();function pe({children:t}){const[e,o]=y.useState([]),[l,r]=y.useState(k("modal"));return s.jsx(pt,{value:{stack:e,addModal:(d,c)=>{o(a=>[...new Set([...a,d])]),r(a=>typeof c=="number"&&typeof a=="number"?Math.max(a,c):a)},removeModal:d=>o(c=>c.filter(a=>a!==d)),getZIndex:d=>`calc(${l} + ${e.indexOf(d)} + 1)`,currentId:e[e.length-1],maxZIndex:l},children:t})}pe.displayName="@mantine/core/ModalStack";const yt={},$=T((t,e)=>{const o=w("ModalTitle",yt,t),{classNames:l,className:r,style:d,styles:c,vars:a,...i}=o,n=N();return s.jsx(me,{ref:e,...n.getStyles("title",{classNames:l,style:d,styles:c,className:r}),...i})});$.classes=g;$.displayName="@mantine/core/ModalTitle";const ht={closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:k("modal"),transitionProps:{duration:200,transition:"fade-down"},withOverlay:!0,withCloseButton:!0},h=T((t,e)=>{const{title:o,withOverlay:l,overlayProps:r,withCloseButton:d,closeButtonProps:c,children:a,radius:i,opened:n,stackId:u,zIndex:f,...m}=w("Modal",ht,t),p=ft(),S=!!o||d,x=p&&u?{closeOnEscape:p.currentId===u,trapFocus:p.currentId===u,zIndex:p.getZIndex(u)}:{},v=l===!1?!1:u&&p?p.currentId===u:n;return y.useEffect(()=>{p&&u&&(n?p.addModal(u,f||k("modal")):p.removeModal(u))},[n,u,f]),s.jsxs(_,{ref:e,radius:i,opened:n,zIndex:p&&u?p.getZIndex(u):f,...m,...x,children:[l&&s.jsx(L,{visible:v,transitionProps:p&&u?{duration:0}:void 0,...r}),s.jsxs(A,{radius:i,__hidden:p&&u&&n?u!==p.currentId:!1,children:[S&&s.jsxs(R,{children:[o&&s.jsx($,{children:o}),d&&s.jsx(I,{...c})]}),s.jsx(O,{children:a})]})]})});h.classes=g;h.displayName="@mantine/core/Modal";h.Root=_;h.Overlay=L;h.Content=A;h.Body=O;h.Header=R;h.Title=$;h.CloseButton=I;h.Stack=pe;const xt={userType:"",password:""};function Mt({opened:t,onComplete:e,accessToken:o}){const{control:l,handleSubmit:r}=X({defaultValues:xt,resolver:ee(ze),mode:"onSubmit"}),{patch:d}=G(),c=async a=>{const i={"Content-Type":"application/json",Authorization:`Bearer ${o}`};try{const{data:n}=await d(W.AUTH.SELECT_ROLE,a,i);e({user:n})}catch(n){return Promise.reject("Complete profile error:",n)}};return s.jsx(h,{opened:t,onClose:()=>{},withCloseButton:!1,title:"Please Update Your Credentials",centered:!0,children:s.jsx(Y,{shadow:"md",radius:"md",p:"xl",withBorder:!0,w:"400px",mx:"auto",children:s.jsxs("form",{onSubmit:r(c),children:[s.jsx(ne,{order:3,mb:"md",children:"Complete Your Profile"}),s.jsxs(z,{children:[s.jsx(U,{name:"userType",control:l,Component:He,componentProps:{label:"User Type",placeholder:"Select a user type",data:[{value:F.CREATOR,label:"Creator"},{value:F.BRAND,label:"Brand"},{value:F.COMMUNITY,label:"Community"}],withAsterisk:!0,searchable:!0,nothingFoundMessage:"No match"}}),s.jsx(U,{name:"password",control:l,Component:te,componentProps:{label:"Set a Password",type:"password",placeholder:"Enter your password",withAsterisk:!0}}),s.jsx(ae,{fullWidth:!0,mt:"md",type:"submit",children:"Complete & Login"})]})]})})})}const gt=()=>{const[t,e]=y.useState(!1),[o,l]=y.useState(null),r=Q(),d=q(),{post:c}=G(),a=async n=>{var u,f;try{const{data:m}=await c(W.AUTH.GOOGLE_OAUTH,{token:n==null?void 0:n.credential});!((u=m.user)!=null&&u.userType)&&!((f=m.user)!=null&&f.password)?(e(!0),l({accessToken:m.accessToken,refreshToken:m.refreshToken})):(r(K({accessToken:m.accessToken,refreshToken:m.refreshToken})),r(H({user:m.user})))}catch(m){j("Login Error",`{${(m==null?void 0:m.message)||"Something went wrong with Google login"} }`,"red")}},i=({user:n})=>{r(K({accessToken:o.accessToken,refreshToken:o.refreshToken})),r(H({user:n})),e(!1),j("Login Successful",`Welcome back, ${n.username}`),d(C.DASHBOARD)};return s.jsxs(s.Fragment,{children:[s.jsx(Le,{onSuccess:a,onError:()=>j("Login Error","Google sign-in failed","red")}),s.jsx(Mt,{opened:t,onClose:()=>e(!1),onComplete:i,accessToken:o==null?void 0:o.accessToken})]})},St={identifier:"",password:""},Tt=[{name:"identifier",label:"Username or email address",placeholder:"Your username or email address",type:te},{name:"password",label:"Password",placeholder:"Your password",type:Ue}];function Et(){const t=Q(),e=q(),{control:o,handleSubmit:l}=X({defaultValues:St,resolver:ee(Ge),mode:"onSubmit"}),{post:r,loading:d,error:c}=G(),a=async i=>{var n,u,f;try{const{data:m}=await r(W.AUTH.LOGIN,i);t($e({accessToken:m.accessToken,refreshToken:m.refreshToken})),t(H({user:m.user})),j("Login Successful",`Welcome back, ${(n=m==null?void 0:m.user)==null?void 0:n.username}!`);const p=(f=(u=m==null?void 0:m.user)==null?void 0:u.userType)==null?void 0:f.toUpperCase();if(console.log("userType",p),!p){j("Login Error","Unknown user type. Contact support","red"),e(C.WELCOMEPAGE);return}p==="BRAND"&&e(C.DASHBOARD),p==="ADMIN"&&e(C.DASHBOARD)}catch(m){j("Login Error",`${(m==null?void 0:m.message)||"Something went wrong"}`,"red"),e(C.WELCOMEPAGE)}};return s.jsx(Fe,{size:"md",children:s.jsx(Y,{radius:"sm",p:"xl",withBorder:!0,bg:"#363a3e",my:"5rem",mx:"xl",children:s.jsx("form",{onSubmit:l(a),children:s.jsxs(z,{spacing:"xl",children:[s.jsx(ne,{order:2,children:"Login"}),c&&s.jsx(J,{color:"red",size:"sm",children:c}),s.jsxs(z,{w:"50%",mx:"auto",children:[Tt.map(({name:i,label:n,placeholder:u,type:f})=>s.jsx(U,{name:i,control:o,Component:f,componentProps:{label:n,placeholder:u,withAsterisk:!0}},i)),s.jsx(V,{position:"apart",mt:"md",style:{justifyContent:"center"},children:s.jsx(ae,{variant:"primary",size:"sm",padding:"0.5rem",width:"8.5rem",type:"submit",loading:d,children:"Login"})}),s.jsxs(J,{size:"xs",mt:"sm",align:"center",children:["Don't have an account?"," ",s.jsx(_e,{to:"/register",style:{textDecoration:"none"},children:"Register"})]})]}),s.jsx(V,{position:"apart",style:{justifyContent:"center"},children:s.jsx(gt,{})})]})})})})}export{Et as default};
