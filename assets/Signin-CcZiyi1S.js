import{r as y,Q as Ne,j as t,S as Ce,T as Pe,B as I,g as ke,V as Ie,W as P,A as B,X as Oe,f as w,u as v,a as z,b as Ee,c as Re,C as _e,z as Ae,n as K,Y as F,m as J,l as Q,Z as Le,I as H,s as T,L as $e,_ as Fe}from"./index-CpVEQC_4.js";import{i as ze,u as X,o as q,c as U,F as D,S as He,j as Ue,a as ee,s as b,A as se,h as De,P as Ge,G as Z,l as Ye}from"./FormField-D3LTF3fr.js";import{d as Ze,F as Ve,P as G,O as We,c as Ke,T as te,s as V}from"./authSlice-Dw1Ggnuc.js";import{c as oe}from"./create-safe-context-B_j5AOLD.js";import{T as ae,B as ne}from"./Button-De23OiHW.js";import{a as Je}from"./DirectionProvider-BmncLHH_.js";import{T as re}from"./Title-e-lfotBg.js";import{T as W}from"./Text-BL3mPqaH.js";function Qe(s,e,o){y.useEffect(()=>(window.addEventListener(s,e,o),()=>window.removeEventListener(s,e,o)),[s,e])}const[Xe,g]=oe("ModalBase component was not found in tree");function qe({opened:s,transitionDuration:e}){const[o,n]=y.useState(s),r=y.useRef(-1),l=Ne()?0:e;return y.useEffect(()=>(s?(n(!0),window.clearTimeout(r.current)):l===0?n(!1):r.current=window.setTimeout(()=>n(!1),l),()=>window.clearTimeout(r.current)),[s,l]),o}function es({id:s,transitionProps:e,opened:o,trapFocus:n,closeOnEscape:r,onClose:c,returnFocus:l}){const a=Je(s),[i,d]=y.useState(!1),[u,f]=y.useState(!1),m=typeof(e==null?void 0:e.duration)=="number"?e==null?void 0:e.duration:200,p=qe({opened:o,transitionDuration:m});return Qe("keydown",S=>{var x;S.key==="Escape"&&r&&!S.isComposing&&o&&((x=S.target)==null?void 0:x.getAttribute("data-mantine-stop-propagation"))!=="true"&&c()},{capture:!0}),Ze({opened:o,shouldReturnFocus:n&&l}),{_id:a,titleMounted:i,bodyMounted:u,shouldLockScroll:p,setTitleMounted:d,setBodyMounted:f}}const le=y.forwardRef(({keepMounted:s,opened:e,onClose:o,id:n,transitionProps:r,onExitTransitionEnd:c,onEnterTransitionEnd:l,trapFocus:a,closeOnEscape:i,returnFocus:d,closeOnClickOutside:u,withinPortal:f,portalProps:m,lockScroll:p,children:S,zIndex:x,shadow:j,padding:k,__vars:ye,unstyled:he,removeScrollProps:xe,...ge},Me)=>{const{_id:Y,titleMounted:Se,bodyMounted:we,shouldLockScroll:ve,setTitleMounted:je,setBodyMounted:Te}=es({id:n,transitionProps:r,opened:e,trapFocus:a,closeOnEscape:i,onClose:o,returnFocus:d}),{key:be,...Be}=xe||{};return t.jsx(Ce,{...m,withinPortal:f,children:t.jsx(Xe,{value:{opened:e,onClose:o,closeOnClickOutside:u,onExitTransitionEnd:c,onEnterTransitionEnd:l,transitionProps:{...r,keepMounted:s},getTitleId:()=>`${Y}-title`,getBodyId:()=>`${Y}-body`,titleMounted:Se,bodyMounted:we,setTitleMounted:je,setBodyMounted:Te,trapFocus:a,closeOnEscape:i,zIndex:x,unstyled:he},children:t.jsx(Pe,{enabled:ve&&p,...Be,children:t.jsx(I,{ref:Me,...ge,__vars:{...ye,"--mb-z-index":(x||P("modal")).toString(),"--mb-shadow":Ie(j),"--mb-padding":ke(k)},children:S})},be)})})});le.displayName="@mantine/core/ModalBase";function ss(){const s=g();return y.useEffect(()=>(s.setBodyMounted(!0),()=>s.setBodyMounted(!1)),[]),s.getBodyId()}var N={title:"m_615af6c9",header:"m_b5489c3c",inner:"m_60c222c7",content:"m_fd1ab0aa",close:"m_606cb269",body:"m_5df29311"};const de=y.forwardRef(({className:s,...e},o)=>{const n=ss(),r=g();return t.jsx(I,{ref:o,...e,id:n,className:B({[N.body]:!r.unstyled},s)})});de.displayName="@mantine/core/ModalBaseBody";const ce=y.forwardRef(({className:s,onClick:e,...o},n)=>{const r=g();return t.jsx(Oe,{ref:n,...o,onClick:c=>{r.onClose(),e==null||e(c)},className:B({[N.close]:!r.unstyled},s),unstyled:r.unstyled})});ce.displayName="@mantine/core/ModalBaseCloseButton";const ie=y.forwardRef(({transitionProps:s,className:e,innerProps:o,onKeyDown:n,style:r,...c},l)=>{const a=g();return t.jsx(ae,{mounted:a.opened,transition:"pop",...a.transitionProps,onExited:()=>{var i,d,u;(i=a.onExitTransitionEnd)==null||i.call(a),(u=(d=a.transitionProps)==null?void 0:d.onExited)==null||u.call(d)},onEntered:()=>{var i,d,u;(i=a.onEnterTransitionEnd)==null||i.call(a),(u=(d=a.transitionProps)==null?void 0:d.onEntered)==null||u.call(d)},...s,children:i=>t.jsx("div",{...o,className:B({[N.inner]:!a.unstyled},o.className),children:t.jsx(Ve,{active:a.opened&&a.trapFocus,innerRef:l,children:t.jsx(G,{...c,component:"section",role:"dialog",tabIndex:-1,"aria-modal":!0,"aria-describedby":a.bodyMounted?a.getBodyId():void 0,"aria-labelledby":a.titleMounted?a.getTitleId():void 0,style:[r,i],className:B({[N.content]:!a.unstyled},e),unstyled:a.unstyled,children:c.children})})})})});ie.displayName="@mantine/core/ModalBaseContent";const ue=y.forwardRef(({className:s,...e},o)=>{const n=g();return t.jsx(I,{component:"header",ref:o,className:B({[N.header]:!n.unstyled},s),...e})});ue.displayName="@mantine/core/ModalBaseHeader";const ts={duration:200,timingFunction:"ease",transition:"fade"};function os(s){const e=g();return{...ts,...e.transitionProps,...s}}const me=y.forwardRef(({onClick:s,transitionProps:e,style:o,visible:n,...r},c)=>{const l=g(),a=os(e);return t.jsx(ae,{mounted:n!==void 0?n:l.opened,...a,transition:"fade",children:i=>t.jsx(We,{ref:c,fixed:!0,style:[o,i],zIndex:l.zIndex,unstyled:l.unstyled,onClick:d=>{s==null||s(d),l.closeOnClickOutside&&l.onClose()},...r})})});me.displayName="@mantine/core/ModalBaseOverlay";function as(){const s=g();return y.useEffect(()=>(s.setTitleMounted(!0),()=>s.setTitleMounted(!1)),[]),s.getTitleId()}const pe=y.forwardRef(({className:s,...e},o)=>{const n=as(),r=g();return t.jsx(I,{component:"h2",ref:o,className:B({[N.title]:!r.unstyled},s),...e,id:n})});pe.displayName="@mantine/core/ModalBaseTitle";function ns({children:s}){return t.jsx(t.Fragment,{children:s})}const[rs,C]=oe("Modal component was not found in tree");var M={root:"m_9df02822",content:"m_54c44539",inner:"m_1f958f16",header:"m_d0e2b9cd"};const ls={},O=w((s,e)=>{const o=v("ModalBody",ls,s),{classNames:n,className:r,style:c,styles:l,vars:a,...i}=o,d=C();return t.jsx(de,{ref:e,...d.getStyles("body",{classNames:n,style:c,styles:l,className:r}),...i})});O.classes=M;O.displayName="@mantine/core/ModalBody";const ds={},E=w((s,e)=>{const o=v("ModalCloseButton",ds,s),{classNames:n,className:r,style:c,styles:l,vars:a,...i}=o,d=C();return t.jsx(ce,{ref:e,...d.getStyles("close",{classNames:n,style:c,styles:l,className:r}),...i})});E.classes=M;E.displayName="@mantine/core/ModalCloseButton";const cs={},R=w((s,e)=>{const o=v("ModalContent",cs,s),{classNames:n,className:r,style:c,styles:l,vars:a,children:i,__hidden:d,...u}=o,f=C(),m=f.scrollAreaComponent||ns;return t.jsx(ie,{...f.getStyles("content",{className:r,style:c,styles:l,classNames:n}),innerProps:f.getStyles("inner",{className:r,style:c,styles:l,classNames:n}),"data-full-screen":f.fullScreen||void 0,"data-modal-content":!0,"data-hidden":d||void 0,ref:e,...u,children:t.jsx(m,{style:{maxHeight:f.fullScreen?"100dvh":`calc(100dvh - (${z(f.yOffset)} * 2))`},children:i})})});R.classes=M;R.displayName="@mantine/core/ModalContent";const is={},_=w((s,e)=>{const o=v("ModalHeader",is,s),{classNames:n,className:r,style:c,styles:l,vars:a,...i}=o,d=C();return t.jsx(ue,{ref:e,...d.getStyles("header",{classNames:n,style:c,styles:l,className:r}),...i})});_.classes=M;_.displayName="@mantine/core/ModalHeader";const us={},A=w((s,e)=>{const o=v("ModalOverlay",us,s),{classNames:n,className:r,style:c,styles:l,vars:a,...i}=o,d=C();return t.jsx(me,{ref:e,...d.getStyles("overlay",{classNames:n,style:c,styles:l,className:r}),...i})});A.classes=M;A.displayName="@mantine/core/ModalOverlay";const ms={__staticSelector:"Modal",closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:P("modal"),transitionProps:{duration:200,transition:"fade-down"},yOffset:"5dvh"},ps=Re((s,{radius:e,size:o,yOffset:n,xOffset:r})=>({root:{"--modal-radius":e===void 0?void 0:Ae(e),"--modal-size":_e(o,"modal-size"),"--modal-y-offset":z(n),"--modal-x-offset":z(r)}})),L=w((s,e)=>{const o=v("ModalRoot",ms,s),{classNames:n,className:r,style:c,styles:l,unstyled:a,vars:i,yOffset:d,scrollAreaComponent:u,radius:f,fullScreen:m,centered:p,xOffset:S,__staticSelector:x,...j}=o,k=Ee({name:x,classes:M,props:o,className:r,style:c,classNames:n,styles:l,unstyled:a,vars:i,varsResolver:ps});return t.jsx(rs,{value:{yOffset:d,scrollAreaComponent:u,getStyles:k,fullScreen:m},children:t.jsx(le,{ref:e,...k("root"),"data-full-screen":m||void 0,"data-centered":p||void 0,"data-offset-scrollbars":u===ze.Autosize||void 0,unstyled:a,...j})})});L.classes=M;L.displayName="@mantine/core/ModalRoot";const[fs,ys]=Ke();function fe({children:s}){const[e,o]=y.useState([]),[n,r]=y.useState(P("modal"));return t.jsx(fs,{value:{stack:e,addModal:(c,l)=>{o(a=>[...new Set([...a,c])]),r(a=>typeof l=="number"&&typeof a=="number"?Math.max(a,l):a)},removeModal:c=>o(l=>l.filter(a=>a!==c)),getZIndex:c=>`calc(${n} + ${e.indexOf(c)} + 1)`,currentId:e[e.length-1],maxZIndex:n},children:s})}fe.displayName="@mantine/core/ModalStack";const hs={},$=w((s,e)=>{const o=v("ModalTitle",hs,s),{classNames:n,className:r,style:c,styles:l,vars:a,...i}=o,d=C();return t.jsx(pe,{ref:e,...d.getStyles("title",{classNames:n,style:c,styles:l,className:r}),...i})});$.classes=M;$.displayName="@mantine/core/ModalTitle";const xs={closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:P("modal"),transitionProps:{duration:200,transition:"fade-down"},withOverlay:!0,withCloseButton:!0},h=w((s,e)=>{const{title:o,withOverlay:n,overlayProps:r,withCloseButton:c,closeButtonProps:l,children:a,radius:i,opened:d,stackId:u,zIndex:f,...m}=v("Modal",xs,s),p=ys(),S=!!o||c,x=p&&u?{closeOnEscape:p.currentId===u,trapFocus:p.currentId===u,zIndex:p.getZIndex(u)}:{},j=n===!1?!1:u&&p?p.currentId===u:d;return y.useEffect(()=>{p&&u&&(d?p.addModal(u,f||P("modal")):p.removeModal(u))},[d,u,f]),t.jsxs(L,{ref:e,radius:i,opened:d,zIndex:p&&u?p.getZIndex(u):f,...m,...x,children:[n&&t.jsx(A,{visible:j,transitionProps:p&&u?{duration:0}:void 0,...r}),t.jsxs(R,{radius:i,__hidden:p&&u&&d?u!==p.currentId:!1,children:[S&&t.jsxs(_,{children:[o&&t.jsx($,{children:o}),c&&t.jsx(E,{...l})]}),t.jsx(O,{children:a})]})]})});h.classes=M;h.displayName="@mantine/core/Modal";h.Root=L;h.Overlay=A;h.Content=R;h.Body=O;h.Header=_;h.Title=$;h.CloseButton=E;h.Stack=fe;const gs={userType:"",password:""};function Ms({opened:s,onComplete:e}){const o=K(l=>l.auth.accessToken),{control:n,handleSubmit:r}=X({defaultValues:gs,resolver:q(Ue),mode:"onSubmit"}),c=async l=>{try{const a=await fetch("http://localhost:3000/api/users/assign-role",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(l)}),{data:i}=await a.json();e({user:i})}catch(a){console.error("Complete profile error:",a)}};return t.jsx(h,{opened:s,onClose:()=>{},withCloseButton:!1,title:"Please Update Your Credentials",centered:!0,children:t.jsx(G,{shadow:"md",radius:"md",p:"xl",withBorder:!0,w:"400px",mx:"auto",children:t.jsxs("form",{onSubmit:r(c),children:[t.jsx(re,{order:3,mb:"md",children:"Complete Your Profile"}),t.jsxs(U,{children:[t.jsx(D,{name:"userType",control:n,Component:He,componentProps:{label:"User Type",placeholder:"Select a user type",data:[{value:F.CREATOR,label:"Creator"},{value:F.BRAND,label:"Brand"},{value:F.COMMUNITY,label:"Community"}],withAsterisk:!0,searchable:!0,nothingFoundMessage:"No match"}}),t.jsx(D,{name:"password",control:n,Component:te,componentProps:{label:"Set a Password",type:"password",placeholder:"Enter your password",withAsterisk:!0}}),t.jsx(ne,{fullWidth:!0,mt:"md",type:"submit",children:"Complete & Login"})]})]})})})}const Ss=()=>{const[s,e]=y.useState(!1),o=J(),n=Q(),{accessToken:r,refreshToken:c}=K(d=>d.auth),{post:l}=ee(),a=async d=>{var u,f;try{const{data:m}=await l(se.AUTH.GOOGLE_OAUTH,{token:d.credential}),p=!((u=m.user)!=null&&u.userType)&&!((f=m.user)!=null&&f.password);o(V({accessToken:m.accessToken,refreshToken:m.refreshToken})),o(H({user:m.user})),b("Login Successful",`Welcome back, ${m.user.username}`),p?e(!0):n(T.dashboard)}catch(m){b("Login Error",`{${(m==null?void 0:m.message)||"Something went wrong with Google login"} }`,"red")}},i=({profile:d})=>{o(V({accessToken:r,refreshToken:c})),o(H({profile:d})),e(!1),n(T.dashboard)};return t.jsxs(t.Fragment,{children:[t.jsx(Le,{onSuccess:a,onError:()=>b("Login Error","Google sign-in failed","red")}),t.jsx(Ms,{opened:s,onClose:()=>e(!1),onComplete:i})]})},ws={identifier:"",password:""},vs=[{name:"identifier",label:"Username or email address",placeholder:"Your username or email address",type:te},{name:"password",label:"Password",placeholder:"Your password",type:Ge}];function Is(){const s=J(),e=Q(),{control:o,handleSubmit:n}=X({defaultValues:ws,resolver:q(Ye),mode:"onSubmit"}),{post:r,loading:c,error:l}=ee(),a=async i=>{var d,u,f;try{const{data:m}=await r(se.AUTH.LOGIN,i);s(Fe({accessToken:m.accessToken,refreshToken:m.refreshToken})),s(H({user:m.user})),b("Login Successful",`Welcome back, ${(d=m==null?void 0:m.user)==null?void 0:d.username}!`);const p=(f=(u=m==null?void 0:m.user)==null?void 0:u.userType)==null?void 0:f.toUpperCase();if(!p){b("Login Error","Unknown user type. Contact support","red"),e(T.welcomePage);return}p==="BRAND"&&e(T.dashboard),p==="ADMIN"&&e(T.dashboard)}catch(m){b("Login Error",`${(m==null?void 0:m.message)||"Something went wrong"}`,"red"),e(T.welcomePage)}};return t.jsx(De,{size:"md",children:t.jsx(G,{radius:"sm",p:"xl",withBorder:!0,bg:"#363a3e",my:"5rem",mx:"xl",children:t.jsx("form",{onSubmit:n(a),children:t.jsxs(U,{spacing:"xl",children:[t.jsx(re,{order:2,children:"Login"}),l&&t.jsx(W,{color:"red",size:"sm",children:l}),t.jsxs(U,{w:"50%",mx:"auto",children:[vs.map(({name:i,label:d,placeholder:u,type:f})=>t.jsx(D,{name:i,control:o,Component:f,componentProps:{label:d,placeholder:u,withAsterisk:!0}},i)),t.jsx(Z,{position:"apart",mt:"md",style:{justifyContent:"center"},children:t.jsx(ne,{variant:"primary",size:"sm",padding:"0.5rem",width:"8.5rem",type:"submit",loading:c,children:"Login"})}),t.jsxs(W,{size:"xs",mt:"sm",align:"center",children:["Don't have an account?"," ",t.jsx($e,{to:"/register",style:{textDecoration:"none"},children:"Register"})]})]}),t.jsx(Z,{position:"apart",style:{justifyContent:"center"},children:t.jsx(Ss,{})})]})})})})}export{Is as default};
