import{a as v,j as e,k as C,l as b,ac as I,B as G,i as R,t as F,ad as T,ae as z,af as E,ag as L}from"./index-C-4AFNO7.js";import{a as V,F as y,C as P,u as $}from"./FormField-CDmgs_EH.js";import{R as j}from"./Radio-6u07n84v.js";import{G as g}from"./Group-CIVdmQNo.js";import{T as B}from"./TextInput-DDuOS7nz.js";import{F as D}from"./FileInput--HYmVBXe.js";import{B as u}from"./Button-BR3F4-qk.js";import{I as M}from"./Image-B2O5Zm9s.js";import{T as h}from"./Text-Bpvfj0Xl.js";import{c as k}from"./createLucideIcon-CFEEk01s.js";import{c as _,d as w,e as A,o as q}from"./index.esm-B3EMEDXu.js";import{G as U,S as N}from"./StatBox-BYq5nTLU.js";import{b as O}from"./useApi-D27OJqXo.js";import{c as Y}from"./selectors-BfVctv7J.js";import{S as H}from"./Stack-cHEUxKAk.js";import{T as W}from"./Textarea-DK1VbgYi.js";import"./get-auto-contrast-value-Da6zqqWm.js";import"./DirectionProvider-CeuBSB5J.js";import"./ActionIcon-CN4WoK2w.js";import"./Flex-CQgSZ6gU.js";import"./chevron-up-DtJG9RYt.js";import"./chevron-down-GNjr-X4T.js";import"./get-style-object-DUJZA7T_.js";import"./get-env-uyVen0u2.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M15 6v6h4l-7 7-7-7h4V6h6z",key:"1thax2"}]],K=k("arrow-big-down",J);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M9 18v-6H5l7-7 7 7h-4v6H9z",key:"1x06kx"}]],X=k("arrow-big-up",Q);function Z({control:o,setValue:s}){const[n,c]=v.useState("url"),d=V({control:o,name:"introVideoUrl"}),r=V({control:o,name:"introVideoFile"});return v.useEffect(()=>{r?c("upload"):d&&c("url")},[d,r]),e.jsxs(e.Fragment,{children:[e.jsx(j.Group,{value:n,onChange:t=>c(t),label:"Intro Video Source",children:e.jsxs(g,{mt:"xs",children:[e.jsx(j,{value:"url",label:"Enter URL"}),e.jsx(j,{value:"upload",label:"Upload File"})]})}),n==="url"?e.jsx(y,{name:"introVideoUrl",control:o,Component:B,componentProps:{label:"Intro Video URL",placeholder:"Paste YouTube video URL",onChange:t=>{s("introVideoUrl",t.currentTarget.value),r&&s("introVideoFile",null)}}}):e.jsx(P,{name:"introVideoFile",control:o,render:({field:t,fieldState:{error:l}})=>e.jsx(D,{label:"Upload Intro Video",accept:"video/*",placeholder:"Upload your video",value:t.value,onChange:p=>{t.onChange(p),d&&s("introVideoUrl","")},error:l==null?void 0:l.message})})]})}const ee=({control:o})=>{const[s,n]=v.useState(""),[c,d]=v.useState(!1),r=C(),t=b(a=>a.bio.gamesUrl),l=async a=>{try{const i=await(await fetch(`https://api.microlink.io?url=${encodeURIComponent(a)}`)).json();if(i.status==="success"){const{title:m,logo:f}=i.data;return{title:m||a,favicon:f||`https://www.google.com/s2/favicons?sz=64&domain_url=${a}`}}}catch{return{title:a,favicon:`https://www.google.com/s2/favicons?sz=64&domain_url=${a}`}}},p=async()=>{const a=s.trim();if(!a)return;d(!0);const x=await l(a),m=t.filter(f=>f.favorite).length<4;r(I({url:a,...x,favorite:m})),n(""),d(!1)};return e.jsxs(g,{align:"flex-end",spacing:"sm",children:[e.jsx(y,{name:"gamesUrl",control:o,Component:B,componentProps:{label:"Preferred Game URL",placeholder:"Enter game site URL",value:s,onChange:a=>n(a.currentTarget.value),style:{flexGrow:1}}}),e.jsx(u,{fz:26,lh:1.2,variant:"primary",onClick:p,loading:c,children:"+"})]})};function oe({games:o,onDelete:s,onFavoriteToggle:n,onMove:c}){const d=o.filter(r=>r.favorite).length;return e.jsx(e.Fragment,{children:o==null?void 0:o.map((r,t)=>{var l;return e.jsxs(g,{spacing:"sm",align:"center",children:[e.jsx(M,{w:32,h:32,src:(l=r.favicon)==null?void 0:l.url,alt:"favicon"}),e.jsxs(G,{style:{flexGrow:1},children:[e.jsx(h,{fw:500,children:r.title}),e.jsx(h,{size:"xs",c:"dimmed",children:r.url})]}),e.jsx(u,{variant:"subtle",disabled:!r.favorite&&d>=4,onClick:()=>n(t),title:r.favorite?"Unmark as favorite":d>=4?"You can only mark up to 4 favorite games":"Mark as favorite",children:r.favorite?e.jsx(h,{children:"Unfavorite"}):e.jsx(h,{children:"Favorite"})}),e.jsx(u,{variant:"light",onClick:()=>c(t,t-1),disabled:t===0,title:"Move Up",children:e.jsx(X,{size:16})}),e.jsx(u,{variant:"light",onClick:()=>c(t,t+1),disabled:t===o.length-1,title:"Move Down",children:e.jsx(K,{size:16})}),e.jsx(u,{size:"xs",color:"red",variant:"light",onClick:()=>s(t),children:"Delete"})]},t)})})}const te=o=>{try{const n=new URL(o).hostname;return["youtube.com","youtu.be"].some(c=>n.includes(c))}catch{return!1}},re=_().shape({introVideoUrl:w().nullable().notRequired().test("is-supported-video-platform","Only YouTube URLs are supported for now",(o,s)=>o?te(o):!!s.parent.introVideoFile).url("Enter a valid video URL"),introVideoFile:A().nullable().notRequired().test("is-video-file","Only video files are allowed",(o,s)=>o?o instanceof File&&o.type.startsWith("video/"):!!s.parent.introVideoUrl),bio:w().max(1e3,"Bio must be under 500 characters").required("Bio is required")});function Be(){const{control:o,handleSubmit:s,setValue:n}=$({resolver:q(re),defaultValues:{introVideoUrl:"",introVideoFile:null,bio:"",gamesUrl:[]}}),{user:c}=b(Y),{patch:d}=O(),r=C(),t=R(),l=b(i=>i.bio),p=l.gamesUrl;v.useEffect(()=>{n("bio",l.bio),n("introVideoUrl",l.introVideoUrl),n("introVideoFile",l.introVideoFile)},[]);const a=i=>{r(E(i))},x=async i=>{try{const m={bio:i.bio,videoBioUrl:i.introVideoUrl,userId:c.id,preferredGames:p.map((f,S)=>({gameUrl:f.url,sortOrder:S,metaData:{}}))};await d("/users-bio.controller",m),r(L({bio:i.bio,introVideoUrl:i.introVideoUrl,introVideoFile:i.introVideoFile})),alert("Profile Updated Successfully"),t("/profile")}catch(m){alert("Failed to update bio"),console.error(m)}};return e.jsxs(e.Fragment,{children:[e.jsxs(g,{pos:"relative",justify:"center",children:[e.jsx(u,{pos:"absolute",left:0,variant:"darkGrey",onClick:()=>t(-1),children:"Back"}),e.jsx(h,{fz:35,align:"center",mb:20,children:"Edit Bio"})]}),e.jsxs(U,{gutter:20,children:[e.jsx(U.Col,{span:{base:12,md:6,lg:8},children:e.jsx(G,{p:"md",bg:F.colors.secondaryGrey[0],style:{borderRadius:F.radius.md},children:e.jsx("form",{onSubmit:s(x),children:e.jsxs(H,{p:20,children:[e.jsx(Z,{control:o,setValue:n}),e.jsx(y,{name:"bio",control:o,Component:W,componentProps:{label:"Bio",placeholder:"Enter your Bio"}}),e.jsx(ee,{control:o}),e.jsx(oe,{games:p,onDelete:i=>r(a(i)),onFavoriteToggle:i=>r(z(i)),onMove:(i,m)=>r(T({from:i,to:m}))}),e.jsx(u,{type:"submit",variant:"primary",width:"10em",children:"Save"})]})})})}),e.jsx(U.Col,{span:{base:12,md:6,lg:4},children:e.jsx(N,{title:"Preview"})})]})]})}export{Be as default};
