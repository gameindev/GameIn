import{j as e,E as w,D as k,a as E,k as U,i as R,G as H,H as C,I as S,m as T,L as $}from"./index-BsMpUA29.js";import{u as B,F as j}from"./FormField-Cazr2VD6.js";import{o as G}from"./index.esm-CrgKsCiV.js";import{b as P}from"./useApi-njmgOnjD.js";import{s as p,C as M}from"./index-CP9L2JwF.js";import{O as F,S as Y,l as z,P as W}from"./validationSchema-DFylVv84.js";import{M as V}from"./Modal-Ccih4fPW.js";import{P as D}from"./Paper-CUTcfW5_.js";import{T as v}from"./Title-DsGIEC2S.js";import{S as y}from"./Stack-DLHzTEgN.js";import{T as I}from"./TextInput-DDQOBNcs.js";import{B as N}from"./Button-46LLuddq.js";import{T as L}from"./Text-Cmlqrx0a.js";import{G as O}from"./Group-B0zyjYIO.js";import"./DirectionProvider-BoNPA4J_.js";import"./Popover-VUlmlAl8.js";import"./get-floating-position-CkoIcyRi.js";import"./FocusTrap-Bg47e-aF.js";import"./ActionIcon-Nz-Gq_nF.js";import"./ComboboxChevron-C-HT9peT.js";import"./get-parsed-combobox-data-BSKT1ADk.js";const _={userType:"",password:""};function q({opened:c,onComplete:t,accessToken:n}){const{control:m,handleSubmit:a}=B({defaultValues:_,resolver:G(F),mode:"onSubmit"}),{patch:d}=P(),h=async u=>{const f={"Content-Type":"application/json",Authorization:`Bearer ${n}`};try{const{data:s}=await d(k.AUTH.SELECT_ROLE,u,f);t({user:s})}catch(s){return Promise.reject("Complete profile error:",s)}};return e.jsx(V,{opened:c,onClose:()=>{},withCloseButton:!1,title:"Please Update Your Credentials",centered:!0,children:e.jsx(D,{shadow:"md",radius:"md",p:"xl",withBorder:!0,w:"400px",mx:"auto",children:e.jsxs("form",{onSubmit:a(h),children:[e.jsx(v,{order:3,mb:"md",children:"Complete Your Profile"}),e.jsxs(y,{children:[e.jsx(j,{name:"userType",control:m,Component:Y,componentProps:{label:"User Type",placeholder:"Select a user type",data:[{value:w.CREATOR,label:"Creator"},{value:w.BRAND,label:"Brand"},{value:w.COMMUNITY,label:"Community"}],withAsterisk:!0,searchable:!0,nothingFoundMessage:"No match"}}),e.jsx(j,{name:"password",control:m,Component:I,componentProps:{label:"Set a Password",type:"password",placeholder:"Enter your password",withAsterisk:!0}}),e.jsx(N,{fullWidth:!0,mt:"md",type:"submit",children:"Complete & Login"})]})]})})})}const J=()=>{const[c,t]=E.useState(!1),[n,m]=E.useState(null),a=U(),d=R(),{post:h}=P(),u=async s=>{var i,l;try{const{data:o}=await h(k.AUTH.GOOGLE_OAUTH,{token:s==null?void 0:s.credential});!((i=o.user)!=null&&i.userType)&&!((l=o.user)!=null&&l.password)?(t(!0),m({accessToken:o.accessToken,refreshToken:o.refreshToken})):(a(C({accessToken:o.accessToken,refreshToken:o.refreshToken})),a(S({user:o.user})))}catch(o){p("Login Error",`{${(o==null?void 0:o.message)||"Something went wrong with Google login"} }`,"red")}},f=({user:s})=>{a(C({accessToken:n.accessToken,refreshToken:n.refreshToken})),a(S({user:s})),t(!1),p("Login Successful",`Welcome back, ${s.username}`),d(T.ACCOUNTS.DASHBOARD.ROOT)};return e.jsxs(e.Fragment,{children:[e.jsx(H,{onSuccess:u,onError:()=>p("Login Error","Google sign-in failed","red")}),e.jsx(q,{opened:c,onClose:()=>t(!1),onComplete:f,accessToken:n==null?void 0:n.accessToken})]})},K={identifier:"",password:""},Q=[{name:"identifier",label:"Username or email address",placeholder:"Your username or email address",type:I},{name:"password",label:"Password",placeholder:"Your password",type:W}];function we(){const c=U(),t=R(),{control:n,handleSubmit:m}=B({defaultValues:K,resolver:G(z),mode:"onSubmit"}),{post:a,get:d,loading:h,error:u}=P(),f=async s=>{var i,l,o;try{const{data:r}=await a(k.AUTH.LOGIN,s);console.log(r),c(C({accessToken:r.accessToken,refreshToken:r.refreshToken,user:r.user}));const A=(i=r==null?void 0:r.user)==null?void 0:i.id,g=(o=(l=r==null?void 0:r.user)==null?void 0:l.userType)==null?void 0:o.toUpperCase();if(!A||!g){p("Login Error","User information incomplete","red"),t(T.WELCOMEPAGE);return}const b=g==="BRAND"?"brandProfile":g==="CREATOR"?"creatorProfile":"",{data:x}=await d(`/users/${A}${b?`?populate=${b}`:""}`);console.log(x),c(S({user:x})),p("Login Successful",`Welcome back, ${x.username||"user"}!`),t(T.ACCOUNTS.DASHBOARD.ROOT)}catch(r){p("Login Error",(r==null?void 0:r.message)||"Something went wrong","red"),t(T.WELCOMEPAGE)}};return e.jsx(M,{size:"md",children:e.jsx(D,{radius:"sm",p:"xl",withBorder:!0,bg:"#363a3e",my:"5em",mx:"xl",children:e.jsx("form",{onSubmit:m(f),children:e.jsxs(y,{spacing:"xl",children:[e.jsx(v,{order:2,children:"Login"}),u&&e.jsx(L,{c:"red",size:"sm",children:u}),e.jsxs(y,{w:"50%",mx:"auto",children:[Q.map(({name:s,label:i,placeholder:l,type:o})=>e.jsx(j,{name:s,control:n,Component:o,componentProps:{label:i,placeholder:l,withAsterisk:!0}},s)),e.jsx(O,{position:"center",mt:"md",style:{justifyContent:"center"},children:e.jsx(N,{variant:"primary",size:"sm",type:"submit",loading:h,children:"Login"})}),e.jsxs(L,{size:"xs",mt:"sm",align:"center",children:["Don't have an account?"," ",e.jsx($,{to:"/register",style:{textDecoration:"none"},children:"Register"})]})]}),e.jsx(O,{position:"center",style:{justifyContent:"center"},children:e.jsx(J,{})})]})})})})}export{we as default};
