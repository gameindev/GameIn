import{r as y,G as Ne,j as s,H as Ce,I as Pe,B as k,J as Oe,K as ke,M as P,z as b,N as Ae,f as w,u as v,a as F,e as Ee,w as Ie,A as Re,y as _e,l as K,P as D,k as J,i as Q,Q as Le,o as T,S as H,L as $e,T as De}from"./index-Bvd2CHyN.js";import{u as q,o as X,S as z,F as G,b as ee,s as B,A as te,a as Fe,G as Y}from"./FormField-D9Jp5b-z.js";import{c as He,S as ze,O as Ge,P as Ue,l as We}from"./validationSchema-BUlc1yj6.js";import{d as Ye,F as Ze,b as U,O as Ve,c as Ke,T as se,s as Z}from"./authSlice-CF_2EQ7P.js";import{c as oe}from"./create-safe-context-DG18b0K9.js";import{T as ae,B as ne}from"./Button-D1gE6iMF.js";import{a as Je}from"./DirectionProvider-BHalFDCQ.js";import{T as re}from"./Title-Ck0LN4R4.js";import{T as V}from"./Text-C5j50kB0.js";function Qe(t,e,o){y.useEffect(()=>(window.addEventListener(t,e,o),()=>window.removeEventListener(t,e,o)),[t,e])}const[qe,M]=oe("ModalBase component was not found in tree");function Xe({opened:t,transitionDuration:e}){const[o,n]=y.useState(t),r=y.useRef(-1),l=Ne()?0:e;return y.useEffect(()=>(t?(n(!0),window.clearTimeout(r.current)):l===0?n(!1):r.current=window.setTimeout(()=>n(!1),l),()=>window.clearTimeout(r.current)),[t,l]),o}function et({id:t,transitionProps:e,opened:o,trapFocus:n,closeOnEscape:r,onClose:c,returnFocus:l}){const a=Je(t),[i,d]=y.useState(!1),[u,f]=y.useState(!1),m=typeof(e==null?void 0:e.duration)=="number"?e==null?void 0:e.duration:200,p=Xe({opened:o,transitionDuration:m});return Qe("keydown",S=>{var x;S.key==="Escape"&&r&&!S.isComposing&&o&&((x=S.target)==null?void 0:x.getAttribute("data-mantine-stop-propagation"))!=="true"&&c()},{capture:!0}),Ye({opened:o,shouldReturnFocus:n&&l}),{_id:a,titleMounted:i,bodyMounted:u,shouldLockScroll:p,setTitleMounted:d,setBodyMounted:f}}const le=y.forwardRef(({keepMounted:t,opened:e,onClose:o,id:n,transitionProps:r,onExitTransitionEnd:c,onEnterTransitionEnd:l,trapFocus:a,closeOnEscape:i,returnFocus:d,closeOnClickOutside:u,withinPortal:f,portalProps:m,lockScroll:p,children:S,zIndex:x,shadow:j,padding:O,__vars:ye,unstyled:he,removeScrollProps:xe,...Me},ge)=>{const{_id:W,titleMounted:Se,bodyMounted:we,shouldLockScroll:ve,setTitleMounted:je,setBodyMounted:Te}=et({id:n,transitionProps:r,opened:e,trapFocus:a,closeOnEscape:i,onClose:o,returnFocus:d}),{key:Be,...be}=xe||{};return s.jsx(Ce,{...m,withinPortal:f,children:s.jsx(qe,{value:{opened:e,onClose:o,closeOnClickOutside:u,onExitTransitionEnd:c,onEnterTransitionEnd:l,transitionProps:{...r,keepMounted:t},getTitleId:()=>`${W}-title`,getBodyId:()=>`${W}-body`,titleMounted:Se,bodyMounted:we,setTitleMounted:je,setBodyMounted:Te,trapFocus:a,closeOnEscape:i,zIndex:x,unstyled:he},children:s.jsx(Pe,{enabled:ve&&p,...be,children:s.jsx(k,{ref:ge,...Me,__vars:{...ye,"--mb-z-index":(x||P("modal")).toString(),"--mb-shadow":ke(j),"--mb-padding":Oe(O)},children:S})},Be)})})});le.displayName="@mantine/core/ModalBase";function tt(){const t=M();return y.useEffect(()=>(t.setBodyMounted(!0),()=>t.setBodyMounted(!1)),[]),t.getBodyId()}var N={title:"m_615af6c9",header:"m_b5489c3c",inner:"m_60c222c7",content:"m_fd1ab0aa",close:"m_606cb269",body:"m_5df29311"};const de=y.forwardRef(({className:t,...e},o)=>{const n=tt(),r=M();return s.jsx(k,{ref:o,...e,id:n,className:b({[N.body]:!r.unstyled},t)})});de.displayName="@mantine/core/ModalBaseBody";const ce=y.forwardRef(({className:t,onClick:e,...o},n)=>{const r=M();return s.jsx(Ae,{ref:n,...o,onClick:c=>{r.onClose(),e==null||e(c)},className:b({[N.close]:!r.unstyled},t),unstyled:r.unstyled})});ce.displayName="@mantine/core/ModalBaseCloseButton";const ie=y.forwardRef(({transitionProps:t,className:e,innerProps:o,onKeyDown:n,style:r,...c},l)=>{const a=M();return s.jsx(ae,{mounted:a.opened,transition:"pop",...a.transitionProps,onExited:()=>{var i,d,u;(i=a.onExitTransitionEnd)==null||i.call(a),(u=(d=a.transitionProps)==null?void 0:d.onExited)==null||u.call(d)},onEntered:()=>{var i,d,u;(i=a.onEnterTransitionEnd)==null||i.call(a),(u=(d=a.transitionProps)==null?void 0:d.onEntered)==null||u.call(d)},...t,children:i=>s.jsx("div",{...o,className:b({[N.inner]:!a.unstyled},o.className),children:s.jsx(Ze,{active:a.opened&&a.trapFocus,innerRef:l,children:s.jsx(U,{...c,component:"section",role:"dialog",tabIndex:-1,"aria-modal":!0,"aria-describedby":a.bodyMounted?a.getBodyId():void 0,"aria-labelledby":a.titleMounted?a.getTitleId():void 0,style:[r,i],className:b({[N.content]:!a.unstyled},e),unstyled:a.unstyled,children:c.children})})})})});ie.displayName="@mantine/core/ModalBaseContent";const ue=y.forwardRef(({className:t,...e},o)=>{const n=M();return s.jsx(k,{component:"header",ref:o,className:b({[N.header]:!n.unstyled},t),...e})});ue.displayName="@mantine/core/ModalBaseHeader";const st={duration:200,timingFunction:"ease",transition:"fade"};function ot(t){const e=M();return{...st,...e.transitionProps,...t}}const me=y.forwardRef(({onClick:t,transitionProps:e,style:o,visible:n,...r},c)=>{const l=M(),a=ot(e);return s.jsx(ae,{mounted:n!==void 0?n:l.opened,...a,transition:"fade",children:i=>s.jsx(Ve,{ref:c,fixed:!0,style:[o,i],zIndex:l.zIndex,unstyled:l.unstyled,onClick:d=>{t==null||t(d),l.closeOnClickOutside&&l.onClose()},...r})})});me.displayName="@mantine/core/ModalBaseOverlay";function at(){const t=M();return y.useEffect(()=>(t.setTitleMounted(!0),()=>t.setTitleMounted(!1)),[]),t.getTitleId()}const pe=y.forwardRef(({className:t,...e},o)=>{const n=at(),r=M();return s.jsx(k,{component:"h2",ref:o,className:b({[N.title]:!r.unstyled},t),...e,id:n})});pe.displayName="@mantine/core/ModalBaseTitle";function nt({children:t}){return s.jsx(s.Fragment,{children:t})}const[rt,C]=oe("Modal component was not found in tree");var g={root:"m_9df02822",content:"m_54c44539",inner:"m_1f958f16",header:"m_d0e2b9cd"};const lt={},A=w((t,e)=>{const o=v("ModalBody",lt,t),{classNames:n,className:r,style:c,styles:l,vars:a,...i}=o,d=C();return s.jsx(de,{ref:e,...d.getStyles("body",{classNames:n,style:c,styles:l,className:r}),...i})});A.classes=g;A.displayName="@mantine/core/ModalBody";const dt={},E=w((t,e)=>{const o=v("ModalCloseButton",dt,t),{classNames:n,className:r,style:c,styles:l,vars:a,...i}=o,d=C();return s.jsx(ce,{ref:e,...d.getStyles("close",{classNames:n,style:c,styles:l,className:r}),...i})});E.classes=g;E.displayName="@mantine/core/ModalCloseButton";const ct={},I=w((t,e)=>{const o=v("ModalContent",ct,t),{classNames:n,className:r,style:c,styles:l,vars:a,children:i,__hidden:d,...u}=o,f=C(),m=f.scrollAreaComponent||nt;return s.jsx(ie,{...f.getStyles("content",{className:r,style:c,styles:l,classNames:n}),innerProps:f.getStyles("inner",{className:r,style:c,styles:l,classNames:n}),"data-full-screen":f.fullScreen||void 0,"data-modal-content":!0,"data-hidden":d||void 0,ref:e,...u,children:s.jsx(m,{style:{maxHeight:f.fullScreen?"100dvh":`calc(100dvh - (${F(f.yOffset)} * 2))`},children:i})})});I.classes=g;I.displayName="@mantine/core/ModalContent";const it={},R=w((t,e)=>{const o=v("ModalHeader",it,t),{classNames:n,className:r,style:c,styles:l,vars:a,...i}=o,d=C();return s.jsx(ue,{ref:e,...d.getStyles("header",{classNames:n,style:c,styles:l,className:r}),...i})});R.classes=g;R.displayName="@mantine/core/ModalHeader";const ut={},_=w((t,e)=>{const o=v("ModalOverlay",ut,t),{classNames:n,className:r,style:c,styles:l,vars:a,...i}=o,d=C();return s.jsx(me,{ref:e,...d.getStyles("overlay",{classNames:n,style:c,styles:l,className:r}),...i})});_.classes=g;_.displayName="@mantine/core/ModalOverlay";const mt={__staticSelector:"Modal",closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:P("modal"),transitionProps:{duration:200,transition:"fade-down"},yOffset:"5dvh"},pt=Ie((t,{radius:e,size:o,yOffset:n,xOffset:r})=>({root:{"--modal-radius":e===void 0?void 0:_e(e),"--modal-size":Re(o,"modal-size"),"--modal-y-offset":F(n),"--modal-x-offset":F(r)}})),L=w((t,e)=>{const o=v("ModalRoot",mt,t),{classNames:n,className:r,style:c,styles:l,unstyled:a,vars:i,yOffset:d,scrollAreaComponent:u,radius:f,fullScreen:m,centered:p,xOffset:S,__staticSelector:x,...j}=o,O=Ee({name:x,classes:g,props:o,className:r,style:c,classNames:n,styles:l,unstyled:a,vars:i,varsResolver:pt});return s.jsx(rt,{value:{yOffset:d,scrollAreaComponent:u,getStyles:O,fullScreen:m},children:s.jsx(le,{ref:e,...O("root"),"data-full-screen":m||void 0,"data-centered":p||void 0,"data-offset-scrollbars":u===He.Autosize||void 0,unstyled:a,...j})})});L.classes=g;L.displayName="@mantine/core/ModalRoot";const[ft,yt]=Ke();function fe({children:t}){const[e,o]=y.useState([]),[n,r]=y.useState(P("modal"));return s.jsx(ft,{value:{stack:e,addModal:(c,l)=>{o(a=>[...new Set([...a,c])]),r(a=>typeof l=="number"&&typeof a=="number"?Math.max(a,l):a)},removeModal:c=>o(l=>l.filter(a=>a!==c)),getZIndex:c=>`calc(${n} + ${e.indexOf(c)} + 1)`,currentId:e[e.length-1],maxZIndex:n},children:t})}fe.displayName="@mantine/core/ModalStack";const ht={},$=w((t,e)=>{const o=v("ModalTitle",ht,t),{classNames:n,className:r,style:c,styles:l,vars:a,...i}=o,d=C();return s.jsx(pe,{ref:e,...d.getStyles("title",{classNames:n,style:c,styles:l,className:r}),...i})});$.classes=g;$.displayName="@mantine/core/ModalTitle";const xt={closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:P("modal"),transitionProps:{duration:200,transition:"fade-down"},withOverlay:!0,withCloseButton:!0},h=w((t,e)=>{const{title:o,withOverlay:n,overlayProps:r,withCloseButton:c,closeButtonProps:l,children:a,radius:i,opened:d,stackId:u,zIndex:f,...m}=v("Modal",xt,t),p=yt(),S=!!o||c,x=p&&u?{closeOnEscape:p.currentId===u,trapFocus:p.currentId===u,zIndex:p.getZIndex(u)}:{},j=n===!1?!1:u&&p?p.currentId===u:d;return y.useEffect(()=>{p&&u&&(d?p.addModal(u,f||P("modal")):p.removeModal(u))},[d,u,f]),s.jsxs(L,{ref:e,radius:i,opened:d,zIndex:p&&u?p.getZIndex(u):f,...m,...x,children:[n&&s.jsx(_,{visible:j,transitionProps:p&&u?{duration:0}:void 0,...r}),s.jsxs(I,{radius:i,__hidden:p&&u&&d?u!==p.currentId:!1,children:[S&&s.jsxs(R,{children:[o&&s.jsx($,{children:o}),c&&s.jsx(E,{...l})]}),s.jsx(A,{children:a})]})]})});h.classes=g;h.displayName="@mantine/core/Modal";h.Root=L;h.Overlay=_;h.Content=I;h.Body=A;h.Header=R;h.Title=$;h.CloseButton=E;h.Stack=fe;const Mt={userType:"",password:""};function gt({opened:t,onComplete:e}){const o=K(l=>l.auth.accessToken),{control:n,handleSubmit:r}=q({defaultValues:Mt,resolver:X(Ge),mode:"onSubmit"}),c=async l=>{try{const a=await fetch("https://grvroy.com/nest/api/users/assign-role",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(l)}),{data:i}=await a.json();e({user:i})}catch(a){console.error("Complete profile error:",a)}};return s.jsx(h,{opened:t,onClose:()=>{},withCloseButton:!1,title:"Please Update Your Credentials",centered:!0,children:s.jsx(U,{shadow:"md",radius:"md",p:"xl",withBorder:!0,w:"400px",mx:"auto",children:s.jsxs("form",{onSubmit:r(c),children:[s.jsx(re,{order:3,mb:"md",children:"Complete Your Profile"}),s.jsxs(z,{children:[s.jsx(G,{name:"userType",control:n,Component:ze,componentProps:{label:"User Type",placeholder:"Select a user type",data:[{value:D.CREATOR,label:"Creator"},{value:D.BRAND,label:"Brand"},{value:D.COMMUNITY,label:"Community"}],withAsterisk:!0,searchable:!0,nothingFoundMessage:"No match"}}),s.jsx(G,{name:"password",control:n,Component:se,componentProps:{label:"Set a Password",type:"password",placeholder:"Enter your password",withAsterisk:!0}}),s.jsx(ne,{fullWidth:!0,mt:"md",type:"submit",children:"Complete & Login"})]})]})})})}const St=()=>{const[t,e]=y.useState(!1),o=J(),n=Q(),{accessToken:r,refreshToken:c}=K(d=>d.auth),{post:l}=ee(),a=async d=>{var u,f;try{const{data:m}=await l(te.AUTH.GOOGLE_OAUTH,{token:d.credential});!((u=m.user)!=null&&u.userType)&&!((f=m.user)!=null&&f.password)?e(!0):n(T.DASHBOARD),o(Z({accessToken:m.accessToken,refreshToken:m.refreshToken})),o(H({user:m.user})),B("Login Successful",`Welcome back, ${m.user.username}`)}catch(m){B("Login Error",`{${(m==null?void 0:m.message)||"Something went wrong with Google login"} }`,"red")}},i=({profile:d})=>{o(Z({accessToken:r,refreshToken:c})),o(H({profile:d})),e(!1),n(T.DASHBOARD)};return s.jsxs(s.Fragment,{children:[s.jsx(Le,{onSuccess:a,onError:()=>B("Login Error","Google sign-in failed","red")}),s.jsx(gt,{opened:t,onClose:()=>e(!1),onComplete:i})]})},wt={identifier:"",password:""},vt=[{name:"identifier",label:"Username or email address",placeholder:"Your username or email address",type:se},{name:"password",label:"Password",placeholder:"Your password",type:Ue}];function At(){const t=J(),e=Q(),{control:o,handleSubmit:n}=q({defaultValues:wt,resolver:X(We),mode:"onSubmit"}),{post:r,loading:c,error:l}=ee(),a=async i=>{var d,u,f;try{const{data:m}=await r(te.AUTH.LOGIN,i);t(De({accessToken:m.accessToken,refreshToken:m.refreshToken})),t(H({user:m.user})),B("Login Successful",`Welcome back, ${(d=m==null?void 0:m.user)==null?void 0:d.username}!`);const p=(f=(u=m==null?void 0:m.user)==null?void 0:u.userType)==null?void 0:f.toUpperCase();if(!p){B("Login Error","Unknown user type. Contact support","red"),e(T.WELCOMEPAGE);return}p==="BRAND"&&e(T.DASHBOARD),p==="ADMIN"&&e(T.DASHBOARD)}catch(m){B("Login Error",`${(m==null?void 0:m.message)||"Something went wrong"}`,"red"),e(T.WELCOMEPAGE)}};return s.jsx(Fe,{size:"md",children:s.jsx(U,{radius:"sm",p:"xl",withBorder:!0,bg:"#363a3e",my:"5rem",mx:"xl",children:s.jsx("form",{onSubmit:n(a),children:s.jsxs(z,{spacing:"xl",children:[s.jsx(re,{order:2,children:"Login"}),l&&s.jsx(V,{color:"red",size:"sm",children:l}),s.jsxs(z,{w:"50%",mx:"auto",children:[vt.map(({name:i,label:d,placeholder:u,type:f})=>s.jsx(G,{name:i,control:o,Component:f,componentProps:{label:d,placeholder:u,withAsterisk:!0}},i)),s.jsx(Y,{position:"apart",mt:"md",style:{justifyContent:"center"},children:s.jsx(ne,{variant:"primary",size:"sm",padding:"0.5rem",width:"8.5rem",type:"submit",loading:c,children:"Login"})}),s.jsxs(V,{size:"xs",mt:"sm",align:"center",children:["Don't have an account?"," ",s.jsx($e,{to:"/register",style:{textDecoration:"none"},children:"Register"})]})]}),s.jsx(Y,{position:"apart",style:{justifyContent:"center"},children:s.jsx(St,{})})]})})})})}export{At as default};
