import{r as y,H as be,j as t,I as Ne,J as Ce,B as O,K as ke,M as Pe,N as k,z as B,P as Oe,f as w,u as T,a as D,e as Ee,w as Ie,A as Ae,y as Re,F,k as K,i as J,Q as _e,S as H,o as C,L as Le,T as $e}from"./index-CjX4y3jd.js";import{u as Q,o as q,S as z,F as U,b as X,s as j,A as ee,a as Fe,G as Y}from"./FormField-OILbaVwm.js";import{c as De,S as He,O as ze,P as Ue,l as Ge}from"./validationSchema-JKIHvu3M.js";import{d as We,F as Ye,b as G,O as Ze,c as Ve,T as se,s as Z}from"./authSlice-BidBYqDz.js";import{c as te}from"./create-safe-context-ClvpoVFk.js";import{T as oe,B as ne}from"./Button-Canbk1V1.js";import{a as Ke}from"./DirectionProvider-c0LrZbAu.js";import{T as ae}from"./Title-BaCLtjox.js";import{T as V}from"./Text-DvBCE4V3.js";function Je(s,e,o){y.useEffect(()=>(window.addEventListener(s,e,o),()=>window.removeEventListener(s,e,o)),[s,e])}const[Qe,M]=te("ModalBase component was not found in tree");function qe({opened:s,transitionDuration:e}){const[o,r]=y.useState(s),a=y.useRef(-1),d=be()?0:e;return y.useEffect(()=>(s?(r(!0),window.clearTimeout(a.current)):d===0?r(!1):a.current=window.setTimeout(()=>r(!1),d),()=>window.clearTimeout(a.current)),[s,d]),o}function Xe({id:s,transitionProps:e,opened:o,trapFocus:r,closeOnEscape:a,onClose:c,returnFocus:d}){const n=Ke(s),[i,l]=y.useState(!1),[u,f]=y.useState(!1),m=typeof(e==null?void 0:e.duration)=="number"?e==null?void 0:e.duration:200,p=qe({opened:o,transitionDuration:m});return Je("keydown",S=>{var x;S.key==="Escape"&&a&&!S.isComposing&&o&&((x=S.target)==null?void 0:x.getAttribute("data-mantine-stop-propagation"))!=="true"&&c()},{capture:!0}),We({opened:o,shouldReturnFocus:r&&d}),{_id:n,titleMounted:i,bodyMounted:u,shouldLockScroll:p,setTitleMounted:l,setBodyMounted:f}}const re=y.forwardRef(({keepMounted:s,opened:e,onClose:o,id:r,transitionProps:a,onExitTransitionEnd:c,onEnterTransitionEnd:d,trapFocus:n,closeOnEscape:i,returnFocus:l,closeOnClickOutside:u,withinPortal:f,portalProps:m,lockScroll:p,children:S,zIndex:x,shadow:v,padding:P,__vars:fe,unstyled:ye,removeScrollProps:he,...xe},Me)=>{const{_id:W,titleMounted:ge,bodyMounted:Se,shouldLockScroll:we,setTitleMounted:Te,setBodyMounted:ve}=Xe({id:r,transitionProps:a,opened:e,trapFocus:n,closeOnEscape:i,onClose:o,returnFocus:l}),{key:je,...Be}=he||{};return t.jsx(Ne,{...m,withinPortal:f,children:t.jsx(Qe,{value:{opened:e,onClose:o,closeOnClickOutside:u,onExitTransitionEnd:c,onEnterTransitionEnd:d,transitionProps:{...a,keepMounted:s},getTitleId:()=>`${W}-title`,getBodyId:()=>`${W}-body`,titleMounted:ge,bodyMounted:Se,setTitleMounted:Te,setBodyMounted:ve,trapFocus:n,closeOnEscape:i,zIndex:x,unstyled:ye},children:t.jsx(Ce,{enabled:we&&p,...Be,children:t.jsx(O,{ref:Me,...xe,__vars:{...fe,"--mb-z-index":(x||k("modal")).toString(),"--mb-shadow":Pe(v),"--mb-padding":ke(P)},children:S})},je)})})});re.displayName="@mantine/core/ModalBase";function es(){const s=M();return y.useEffect(()=>(s.setBodyMounted(!0),()=>s.setBodyMounted(!1)),[]),s.getBodyId()}var b={title:"m_615af6c9",header:"m_b5489c3c",inner:"m_60c222c7",content:"m_fd1ab0aa",close:"m_606cb269",body:"m_5df29311"};const le=y.forwardRef(({className:s,...e},o)=>{const r=es(),a=M();return t.jsx(O,{ref:o,...e,id:r,className:B({[b.body]:!a.unstyled},s)})});le.displayName="@mantine/core/ModalBaseBody";const de=y.forwardRef(({className:s,onClick:e,...o},r)=>{const a=M();return t.jsx(Oe,{ref:r,...o,onClick:c=>{a.onClose(),e==null||e(c)},className:B({[b.close]:!a.unstyled},s),unstyled:a.unstyled})});de.displayName="@mantine/core/ModalBaseCloseButton";const ce=y.forwardRef(({transitionProps:s,className:e,innerProps:o,onKeyDown:r,style:a,...c},d)=>{const n=M();return t.jsx(oe,{mounted:n.opened,transition:"pop",...n.transitionProps,onExited:()=>{var i,l,u;(i=n.onExitTransitionEnd)==null||i.call(n),(u=(l=n.transitionProps)==null?void 0:l.onExited)==null||u.call(l)},onEntered:()=>{var i,l,u;(i=n.onEnterTransitionEnd)==null||i.call(n),(u=(l=n.transitionProps)==null?void 0:l.onEntered)==null||u.call(l)},...s,children:i=>t.jsx("div",{...o,className:B({[b.inner]:!n.unstyled},o.className),children:t.jsx(Ye,{active:n.opened&&n.trapFocus,innerRef:d,children:t.jsx(G,{...c,component:"section",role:"dialog",tabIndex:-1,"aria-modal":!0,"aria-describedby":n.bodyMounted?n.getBodyId():void 0,"aria-labelledby":n.titleMounted?n.getTitleId():void 0,style:[a,i],className:B({[b.content]:!n.unstyled},e),unstyled:n.unstyled,children:c.children})})})})});ce.displayName="@mantine/core/ModalBaseContent";const ie=y.forwardRef(({className:s,...e},o)=>{const r=M();return t.jsx(O,{component:"header",ref:o,className:B({[b.header]:!r.unstyled},s),...e})});ie.displayName="@mantine/core/ModalBaseHeader";const ss={duration:200,timingFunction:"ease",transition:"fade"};function ts(s){const e=M();return{...ss,...e.transitionProps,...s}}const ue=y.forwardRef(({onClick:s,transitionProps:e,style:o,visible:r,...a},c)=>{const d=M(),n=ts(e);return t.jsx(oe,{mounted:r!==void 0?r:d.opened,...n,transition:"fade",children:i=>t.jsx(Ze,{ref:c,fixed:!0,style:[o,i],zIndex:d.zIndex,unstyled:d.unstyled,onClick:l=>{s==null||s(l),d.closeOnClickOutside&&d.onClose()},...a})})});ue.displayName="@mantine/core/ModalBaseOverlay";function os(){const s=M();return y.useEffect(()=>(s.setTitleMounted(!0),()=>s.setTitleMounted(!1)),[]),s.getTitleId()}const me=y.forwardRef(({className:s,...e},o)=>{const r=os(),a=M();return t.jsx(O,{component:"h2",ref:o,className:B({[b.title]:!a.unstyled},s),...e,id:r})});me.displayName="@mantine/core/ModalBaseTitle";function ns({children:s}){return t.jsx(t.Fragment,{children:s})}const[as,N]=te("Modal component was not found in tree");var g={root:"m_9df02822",content:"m_54c44539",inner:"m_1f958f16",header:"m_d0e2b9cd"};const rs={},E=w((s,e)=>{const o=T("ModalBody",rs,s),{classNames:r,className:a,style:c,styles:d,vars:n,...i}=o,l=N();return t.jsx(le,{ref:e,...l.getStyles("body",{classNames:r,style:c,styles:d,className:a}),...i})});E.classes=g;E.displayName="@mantine/core/ModalBody";const ls={},I=w((s,e)=>{const o=T("ModalCloseButton",ls,s),{classNames:r,className:a,style:c,styles:d,vars:n,...i}=o,l=N();return t.jsx(de,{ref:e,...l.getStyles("close",{classNames:r,style:c,styles:d,className:a}),...i})});I.classes=g;I.displayName="@mantine/core/ModalCloseButton";const ds={},A=w((s,e)=>{const o=T("ModalContent",ds,s),{classNames:r,className:a,style:c,styles:d,vars:n,children:i,__hidden:l,...u}=o,f=N(),m=f.scrollAreaComponent||ns;return t.jsx(ce,{...f.getStyles("content",{className:a,style:c,styles:d,classNames:r}),innerProps:f.getStyles("inner",{className:a,style:c,styles:d,classNames:r}),"data-full-screen":f.fullScreen||void 0,"data-modal-content":!0,"data-hidden":l||void 0,ref:e,...u,children:t.jsx(m,{style:{maxHeight:f.fullScreen?"100dvh":`calc(100dvh - (${D(f.yOffset)} * 2))`},children:i})})});A.classes=g;A.displayName="@mantine/core/ModalContent";const cs={},R=w((s,e)=>{const o=T("ModalHeader",cs,s),{classNames:r,className:a,style:c,styles:d,vars:n,...i}=o,l=N();return t.jsx(ie,{ref:e,...l.getStyles("header",{classNames:r,style:c,styles:d,className:a}),...i})});R.classes=g;R.displayName="@mantine/core/ModalHeader";const is={},_=w((s,e)=>{const o=T("ModalOverlay",is,s),{classNames:r,className:a,style:c,styles:d,vars:n,...i}=o,l=N();return t.jsx(ue,{ref:e,...l.getStyles("overlay",{classNames:r,style:c,styles:d,className:a}),...i})});_.classes=g;_.displayName="@mantine/core/ModalOverlay";const us={__staticSelector:"Modal",closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:k("modal"),transitionProps:{duration:200,transition:"fade-down"},yOffset:"5dvh"},ms=Ie((s,{radius:e,size:o,yOffset:r,xOffset:a})=>({root:{"--modal-radius":e===void 0?void 0:Re(e),"--modal-size":Ae(o,"modal-size"),"--modal-y-offset":D(r),"--modal-x-offset":D(a)}})),L=w((s,e)=>{const o=T("ModalRoot",us,s),{classNames:r,className:a,style:c,styles:d,unstyled:n,vars:i,yOffset:l,scrollAreaComponent:u,radius:f,fullScreen:m,centered:p,xOffset:S,__staticSelector:x,...v}=o,P=Ee({name:x,classes:g,props:o,className:a,style:c,classNames:r,styles:d,unstyled:n,vars:i,varsResolver:ms});return t.jsx(as,{value:{yOffset:l,scrollAreaComponent:u,getStyles:P,fullScreen:m},children:t.jsx(re,{ref:e,...P("root"),"data-full-screen":m||void 0,"data-centered":p||void 0,"data-offset-scrollbars":u===De.Autosize||void 0,unstyled:n,...v})})});L.classes=g;L.displayName="@mantine/core/ModalRoot";const[ps,fs]=Ve();function pe({children:s}){const[e,o]=y.useState([]),[r,a]=y.useState(k("modal"));return t.jsx(ps,{value:{stack:e,addModal:(c,d)=>{o(n=>[...new Set([...n,c])]),a(n=>typeof d=="number"&&typeof n=="number"?Math.max(n,d):n)},removeModal:c=>o(d=>d.filter(n=>n!==c)),getZIndex:c=>`calc(${r} + ${e.indexOf(c)} + 1)`,currentId:e[e.length-1],maxZIndex:r},children:s})}pe.displayName="@mantine/core/ModalStack";const ys={},$=w((s,e)=>{const o=T("ModalTitle",ys,s),{classNames:r,className:a,style:c,styles:d,vars:n,...i}=o,l=N();return t.jsx(me,{ref:e,...l.getStyles("title",{classNames:r,style:c,styles:d,className:a}),...i})});$.classes=g;$.displayName="@mantine/core/ModalTitle";const hs={closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:k("modal"),transitionProps:{duration:200,transition:"fade-down"},withOverlay:!0,withCloseButton:!0},h=w((s,e)=>{const{title:o,withOverlay:r,overlayProps:a,withCloseButton:c,closeButtonProps:d,children:n,radius:i,opened:l,stackId:u,zIndex:f,...m}=T("Modal",hs,s),p=fs(),S=!!o||c,x=p&&u?{closeOnEscape:p.currentId===u,trapFocus:p.currentId===u,zIndex:p.getZIndex(u)}:{},v=r===!1?!1:u&&p?p.currentId===u:l;return y.useEffect(()=>{p&&u&&(l?p.addModal(u,f||k("modal")):p.removeModal(u))},[l,u,f]),t.jsxs(L,{ref:e,radius:i,opened:l,zIndex:p&&u?p.getZIndex(u):f,...m,...x,children:[r&&t.jsx(_,{visible:v,transitionProps:p&&u?{duration:0}:void 0,...a}),t.jsxs(A,{radius:i,__hidden:p&&u&&l?u!==p.currentId:!1,children:[S&&t.jsxs(R,{children:[o&&t.jsx($,{children:o}),c&&t.jsx(I,{...d})]}),t.jsx(E,{children:n})]})]})});h.classes=g;h.displayName="@mantine/core/Modal";h.Root=L;h.Overlay=_;h.Content=A;h.Body=E;h.Header=R;h.Title=$;h.CloseButton=I;h.Stack=pe;const xs={userType:"",password:""};function Ms({opened:s,onComplete:e,authTokens:o}){const{control:r,handleSubmit:a}=Q({defaultValues:xs,resolver:q(ze),mode:"onSubmit"}),c=async d=>{try{const n=await fetch("http://localhost:3000/api/users/assign-role",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o==null?void 0:o.accessToken}`},body:JSON.stringify(d)}),{data:i}=await n.json();e({user:i})}catch(n){console.error("Complete profile error:",n)}};return t.jsx(h,{opened:s,onClose:()=>{},withCloseButton:!1,title:"Please Update Your Credentials",centered:!0,children:t.jsx(G,{shadow:"md",radius:"md",p:"xl",withBorder:!0,w:"400px",mx:"auto",children:t.jsxs("form",{onSubmit:a(c),children:[t.jsx(ae,{order:3,mb:"md",children:"Complete Your Profile"}),t.jsxs(z,{children:[t.jsx(U,{name:"userType",control:r,Component:He,componentProps:{label:"User Type",placeholder:"Select a user type",data:[{value:F.CREATOR,label:"Creator"},{value:F.BRAND,label:"Brand"},{value:F.COMMUNITY,label:"Community"}],withAsterisk:!0,searchable:!0,nothingFoundMessage:"No match"}}),t.jsx(U,{name:"password",control:r,Component:se,componentProps:{label:"Set a Password",type:"password",placeholder:"Enter your password",withAsterisk:!0}}),t.jsx(ne,{fullWidth:!0,mt:"md",type:"submit",children:"Complete & Login"})]})]})})})}const gs=()=>{const[s,e]=y.useState(!1),[o,r]=y.useState(null),a=K(),c=J(),{post:d}=X(),n=async l=>{var u,f;try{const{data:m}=await d(ee.AUTH.GOOGLE_OAUTH,{token:l.credential});!((u=m.user)!=null&&u.userType)&&!((f=m.user)!=null&&f.password)?(e(!0),r({accessToken:m.accessToken,refreshToken:m.refreshToken})):(a(Z({accessToken:m.accessToken,refreshToken:m.refreshToken})),a(H({user:m.user})))}catch(m){j("Login Error",`{${(m==null?void 0:m.message)||"Something went wrong with Google login"} }`,"red")}},i=({user:l})=>{console.log(l),a(Z({accessToken:o.accessToken,refreshToken:o.refreshToken})),a(H({user:l})),e(!1),j("Login Successful",`Welcome back, ${l.username}`),c(C.DASHBOARD)};return t.jsxs(t.Fragment,{children:[t.jsx(_e,{onSuccess:n,onError:()=>j("Login Error","Google sign-in failed","red")}),t.jsx(Ms,{opened:s,onClose:()=>e(!1),onComplete:i,authTokens:o})]})},Ss={identifier:"",password:""},ws=[{name:"identifier",label:"Username or email address",placeholder:"Your username or email address",type:se},{name:"password",label:"Password",placeholder:"Your password",type:Ue}];function Os(){const s=K(),e=J(),{control:o,handleSubmit:r}=Q({defaultValues:Ss,resolver:q(Ge),mode:"onSubmit"}),{post:a,loading:c,error:d}=X(),n=async i=>{var l,u,f;try{const{data:m}=await a(ee.AUTH.LOGIN,i);s($e({accessToken:m.accessToken,refreshToken:m.refreshToken})),s(H({user:m.user})),j("Login Successful",`Welcome back, ${(l=m==null?void 0:m.user)==null?void 0:l.username}!`);const p=(f=(u=m==null?void 0:m.user)==null?void 0:u.userType)==null?void 0:f.toUpperCase();if(console.log("userType",p),!p){j("Login Error","Unknown user type. Contact support","red"),e(C.WELCOMEPAGE);return}p==="BRAND"&&e(C.DASHBOARD),p==="ADMIN"&&e(C.DASHBOARD)}catch(m){j("Login Error",`${(m==null?void 0:m.message)||"Something went wrong"}`,"red"),e(C.WELCOMEPAGE)}};return t.jsx(Fe,{size:"md",children:t.jsx(G,{radius:"sm",p:"xl",withBorder:!0,bg:"#363a3e",my:"5rem",mx:"xl",children:t.jsx("form",{onSubmit:r(n),children:t.jsxs(z,{spacing:"xl",children:[t.jsx(ae,{order:2,children:"Login"}),d&&t.jsx(V,{color:"red",size:"sm",children:d}),t.jsxs(z,{w:"50%",mx:"auto",children:[ws.map(({name:i,label:l,placeholder:u,type:f})=>t.jsx(U,{name:i,control:o,Component:f,componentProps:{label:l,placeholder:u,withAsterisk:!0}},i)),t.jsx(Y,{position:"apart",mt:"md",style:{justifyContent:"center"},children:t.jsx(ne,{variant:"primary",size:"sm",padding:"0.5rem",width:"8.5rem",type:"submit",loading:c,children:"Login"})}),t.jsxs(V,{size:"xs",mt:"sm",align:"center",children:["Don't have an account?"," ",t.jsx(Le,{to:"/register",style:{textDecoration:"none"},children:"Register"})]})]}),t.jsx(Y,{position:"apart",style:{justifyContent:"center"},children:t.jsx(gs,{})})]})})})})}export{Os as default};
