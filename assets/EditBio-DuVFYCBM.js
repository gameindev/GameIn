import{a as v,j as e,k as F,l as j,ac as R,B,i as T,t as g,ad as I,ae as E,af as L,ag as z,a4 as P}from"./index-D9oEtHeb.js";import{a as V,F as C,C as A,u as D}from"./FormField-pkCODe5l.js";import{R as U}from"./Radio-QJvdTLG_.js";import{G as x}from"./Group-B6akqJOh.js";import{T as w}from"./TextInput-CYS3MMnp.js";import{F as M}from"./FileInput-CX6dCDu1.js";import{B as p}from"./Button-DE9b1J-V.js";import{T as f}from"./Text-8hgcObZb.js";import{c as G}from"./createLucideIcon-K2Gk7huH.js";import{c as q,d as y,e as N,o as _}from"./index.esm-DgqbvREp.js";import{G as b,S as $}from"./StatBox-CL0MrM3-.js";import{a as O}from"./useApi-HEZO75xY.js";import{c as Y}from"./selectors-BfVctv7J.js";import{S as H}from"./Stack-CmwLihlq.js";import{T as W}from"./Textarea-B5nE1e26.js";import"./get-auto-contrast-value-Da6zqqWm.js";import"./DirectionProvider-D6EKyNqO.js";import"./create-optional-context-nOeOZdkc.js";import"./use-uncontrolled-NxHOPr4h.js";import"./create-safe-context-BzETH9ei.js";import"./Flex-DaaNoCtx.js";import"./ActionIcon-CBmGwXDV.js";import"./chevron-up-BMiZp4Kn.js";import"./chevron-down-iGnCWDjH.js";import"./get-style-object-DUJZA7T_.js";import"./get-env-uyVen0u2.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M15 6v6h4l-7 7-7-7h4V6h6z",key:"1thax2"}]],K=G("arrow-big-down",J);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M9 18v-6H5l7-7 7 7h-4v6H9z",key:"1x06kx"}]],X=G("arrow-big-up",Q);function Z({control:r,setValue:s}){const[n,l]=v.useState("url"),t=V({control:r,name:"introVideoUrl"}),a=V({control:r,name:"introVideoFile"});return v.useEffect(()=>{a?l("upload"):t&&l("url")},[t,a]),e.jsxs(e.Fragment,{children:[e.jsx(U.Group,{value:n,onChange:o=>l(o),label:"Intro Video Source",children:e.jsxs(x,{mt:"xs",children:[e.jsx(U,{value:"url",label:"Enter URL"}),e.jsx(U,{value:"upload",label:"Upload File"})]})}),n==="url"?e.jsx(C,{name:"introVideoUrl",control:r,Component:w,componentProps:{label:"Intro Video URL",placeholder:"Paste YouTube video URL",onChange:o=>{s("introVideoUrl",o.currentTarget.value),a&&s("introVideoFile",null)}}}):e.jsx(A,{name:"introVideoFile",control:r,render:({field:o,fieldState:{error:m}})=>e.jsx(M,{label:"Upload Intro Video",accept:"video/*",placeholder:"Upload your video",value:o.value,onChange:d=>{o.onChange(d),t&&s("introVideoUrl","")},error:m==null?void 0:m.message})})]})}const ee=({control:r})=>{const[s,n]=v.useState(""),l=F(),t=j(o=>o.bio.gamesUrl),a=()=>{const o=s.trim();if(!o)return;const d=t.filter(c=>c.favorite).length<4;l(R({url:o,favorite:d})),n("")};return e.jsxs(x,{align:"flex-end",spacing:"sm",children:[e.jsx(w,{label:"Preferred Game URL",placeholder:"Enter game site URL",value:s,onChange:o=>n(o.currentTarget.value),style:{flexGrow:1}}),e.jsx(p,{fz:26,lh:1.2,variant:"primary",onClick:a,children:"+"})]})};function oe({games:r,onDelete:s,onFavoriteToggle:n,onMove:l}){const t=r.filter(a=>a.favorite).length;return e.jsx(e.Fragment,{children:r==null?void 0:r.map((a,o)=>e.jsxs(x,{spacing:"sm",align:"center",children:[e.jsxs(B,{style:{flexGrow:1},children:[e.jsx(f,{fw:500,children:a.title}),e.jsx(f,{size:"xs",c:"dimmed",children:a.url})]}),e.jsx(p,{variant:"subtle",disabled:!a.favorite&&t>=4,onClick:()=>n(o),title:a.favorite?"Unmark as favorite":t>=4?"You can only mark up to 4 favorite games":"Mark as favorite",children:a.favorite?e.jsx(f,{children:"Unfavorite"}):e.jsx(f,{children:"Favorite"})}),e.jsx(p,{variant:"light",onClick:()=>l(o,o-1),disabled:o===0,title:"Move Up",children:e.jsx(X,{size:16})}),e.jsx(p,{variant:"light",onClick:()=>l(o,o+1),disabled:o===r.length-1,title:"Move Down",children:e.jsx(K,{size:16})}),e.jsx(p,{size:"xs",color:"red",variant:"light",onClick:()=>s(o),children:"Delete"})]},o))})}const re=r=>{try{const n=new URL(r).hostname;return["youtube.com","youtu.be"].some(l=>n.includes(l))}catch{return!1}},te=q().shape({introVideoUrl:y().nullable().notRequired().test("is-supported-video-platform","Only YouTube URLs are supported for now",(r,s)=>r?re(r):!!s.parent.introVideoFile).url("Enter a valid video URL"),introVideoFile:N().nullable().notRequired().test("is-video-file","Only video files are allowed",(r,s)=>r?r instanceof File&&r.type.startsWith("video/"):!!s.parent.introVideoUrl),bio:y().max(1e3,"Bio must be under 500 characters").required("Bio is required")});function Se(){const{control:r,handleSubmit:s,setValue:n,reset:l}=D({resolver:_(te),defaultValues:{introVideoUrl:"",introVideoFile:null,bio:"",gamesUrl:[]}}),{user:t}=j(Y),{patch:a}=O(),o=F(),m=T(),d=j(i=>i.bio),c=d.gamesUrl;console.log(c),v.useEffect(()=>{var i,u;l({bio:d.bio||((i=t==null?void 0:t.userBio)==null?void 0:i.bio)||"",introVideoUrl:d.introVideoUrl||((u=t==null?void 0:t.userBio)==null?void 0:u.videoBioUrl)||"",introVideoFile:d.introVideoFile||null,gamesUrl:c||[]})},[d,t,l,c]);const k=async i=>{try{const u={bio:i.bio,videoBioUrl:i.introVideoUrl,userId:t.id,preferredGames:c.map((h,S)=>({gameUrl:h.url,sortOrder:S,favorite:h.favorite,title:h.title||h.url}))};await a("/users-bio.controller",u),o(z({bio:i.bio,introVideoUrl:i.introVideoUrl,introVideoFile:i.introVideoFile,gamesUrl:c})),o(P()),alert("Profile Updated Successfully"),m("/profile")}catch(u){alert("Failed to update bio"),console.error(u)}};return e.jsxs(e.Fragment,{children:[e.jsxs(x,{pos:"relative",justify:"center",children:[e.jsx(p,{pos:"absolute",left:0,variant:"darkGrey",onClick:()=>m(-1),children:"Back"}),e.jsx(f,{fz:35,align:"center",mb:20,children:"Edit Bio"})]}),e.jsxs(b,{gutter:20,children:[e.jsx(b.Col,{span:{base:12,md:6,lg:8},children:e.jsx(B,{p:"md",bg:g.colors.secondaryGrey[0],style:{borderRadius:g.radius.md},children:e.jsx("form",{onSubmit:s(k),children:e.jsxs(H,{p:20,children:[e.jsx(Z,{control:r,setValue:n}),e.jsx(C,{name:"bio",control:r,Component:W,componentProps:{label:"Bio",placeholder:"Enter your Bio"}}),e.jsx(ee,{control:r}),e.jsx(oe,{games:c,onDelete:i=>o(L(i)),onFavoriteToggle:i=>o(E(i)),onMove:(i,u)=>o(I({from:i,to:u}))}),e.jsx(p,{type:"submit",variant:"primary",width:"10em",children:"Save"})]})})})}),e.jsx(b.Col,{span:{base:12,md:6,lg:4},children:e.jsx($,{title:"Preview"})})]})]})}export{Se as default};
